<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>(3) Analysing Data • pavo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="(3) Analysing Data">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pavo</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">2.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/pavo-1-overview.html">Overview</a>
    </li>
    <li>
      <a href="../articles/pavo-2-importing_processing.html">Importing and Processing Data</a>
    </li>
    <li>
      <a href="../articles/pavo-3-analysing.html">Analysing Data</a>
    </li>
    <li>
      <a href="../articles/pavo-4-spectraldesc.html">Spectral Shape Descriptors</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rmaia/pavo">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>(3) Analysing Data</h1>
                        <h4 class="author">Rafael Maia, Thomas White, Hugo Gruson, Pierre-Paul Bitton, Chad Eliason</h4>
            
            <h4 class="date">2019-08-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rmaia/pavo/blob/master/vignettes/pavo-3-analysing.Rmd"><code>vignettes/pavo-3-analysing.Rmd</code></a></small>
      <div class="hidden name"><code>pavo-3-analysing.Rmd</code></div>

    </div>

    
    
<style type="text/css">
/* Put all captions in italics */
.caption {
  font-style: italic;
}
/* Center all figures. This is actually better than using knitr::opts_chunk
because the code is only written once in the output */
.figure {
  text-align: center;
}
/* Auto-wrap long code line */
code.sourceCode {
  white-space: pre-wrap;
}
</style>
<p>Let’s again begin by loading the package.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># Load the package, and set a global random-number seed for the reproducible generation of fake data later on.</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(pavo)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">1612217</span>)</a></code></pre></div>
<div id="analysing-spectral-data" class="section level1">
<h1 class="hasAnchor">
<a href="#analysing-spectral-data" class="anchor"></a>Analysing Spectral Data</h1>
<div id="spectral-dataset-description" class="section level2">
<h2 class="hasAnchor">
<a href="#spectral-dataset-description" class="anchor"></a>Spectral Dataset Description</h2>
<p>The raw spectral data used in this example are available from the package repository on <a href="https://github.com/rmaia/pavo">github</a>, located <a href="https://github.com/rmaia/pavo/blob/master/data_external/vignette">here</a>. You can download and extract it to follow the vignette exactly. Alternatively, the data are included as an RData file as part of the package installation, and so can be loaded directly (see below).</p>
<p>The data consist of reflectance spectra, obtained using Avantes equipment and software, from seven bird species: Northern Cardinal <em>Cardinalis cardinalis</em>, Wattled Jacana <em>Jacana jacana</em>, Baltimore Oriole <em>Icterus galbula</em>, Peach-fronted Parakeet <em>Aratinga aurea</em>, American Robin <em>Turdus migratorius</em>, and Sayaca Tanager <em>Thraupis sayaca</em>. Several individuals were measured (sample size varies by species), and 3 spectra were collected from each individual. However, the number of individuals measured per species is uneven and the data have additional peculiarities that should emphasize the flexibility <code>pavo</code> offers, as we’ll see below.</p>
<p>In addition, <code>pavo</code> includes three datasets that can be called with the <code>data</code> function. <code><a href="https://rdrr.io/r/utils/data.html">data(teal)</a></code>, <code><a href="https://rdrr.io/r/utils/data.html">data(sicalis)</a></code>, and <code><a href="https://rdrr.io/r/utils/data.html">data(flowers)</a></code> will all be used in this vignette. See the help files for each dataset for more information; via <code><a href="../reference/teal.html">?teal</a></code>, <code><a href="../reference/sicalis.html">?sicalis</a></code>, and <code><a href="../reference/flowers.html">?flowers</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">specs &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/specsdata.rds"</span>, <span class="dt">package =</span> <span class="st">"pavo"</span>))</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">mspecs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aggspec.html">aggspec</a></span>(specs, <span class="dt">by =</span> <span class="dv">3</span>, <span class="dt">FUN =</span> mean)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">spp &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span>(<span class="st">'</span><span class="ch">\\</span><span class="st">.[0-9].*$'</span>, <span class="st">''</span>, <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(mspecs))[<span class="op">-</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">sppspec &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aggspec.html">aggspec</a></span>(mspecs, <span class="dt">by =</span> spp, <span class="dt">FUN =</span> mean)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">spec.sm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(sppspec, <span class="dt">opt =</span> <span class="st">"smooth"</span>, <span class="dt">span =</span> <span class="fl">0.2</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## smoothing spectra with a span of 0.2</code></pre>
</div>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p><code>pavo</code> offers two main approaches for spectral data analysis. First, colour variables can be calculated based on the shape of the reflectance spectra. By using special <code>R</code> classes for spectra data frame objects, this can easily be done using the <code>summary</code> function with an <code>rspec</code> object (see below). The function <code><a href="../reference/peakshape.html">peakshape()</a></code> also returns descriptors for individual peaks in spectral curves, as outlined below.</p>
<p>Second, reflectance spectra can be analysed by accounting for the visual system receiving the colour signal, therefore representing reflectance spectra as perceived colours. To that end, we have implemented a suite of visual models and colourspaces including; the receptor-noise limited model of model of <span class="citation">Vorobyev et al. (1998)</span>, <span class="citation">Endler (1990)</span>’s segment classification method, flexible di- tri- and tetra-chromatic colourspaces, the Hexagon model of <span class="citation">Chittka (1992)</span>, the colour-opponent coding space of <span class="citation">Backhaus (1991)</span>, CIELAB and CIEXYZ spaces, and the categorical model of <span class="citation">Troje (1993)</span>.</p>
</div>
<div id="spectral-shape-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#spectral-shape-analysis" class="anchor"></a>Spectral Shape Analysis</h2>
<div id="colourimetric-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#colourimetric-variables" class="anchor"></a>Colourimetric Variables</h3>
<p>Obtaining colourimetric variables (pertaining to hue, saturation and brightness/value) is pretty straightforward in <code>pavo</code>. Since reflectance spectra is stored in an object of class <code>rspec</code>, the <code>summary</code> function recognizes the object as such and extracts 23 variables, as outlined in <span class="citation">Montgomerie (2006)</span>. Though outlined in a book chapter on bird colouration, these variables are broadly applicable to any reflectance data, particularly if the taxon of interest has colour vision within the UV-human visible range.</p>
<p>The description and formulas for these variables can be found by running <code><a href="../reference/summary.rspec.html">?summary.rspec</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(spec.sm)</a></code></pre></div>
<p><code>summary</code> also takes an additional argument <code>subset</code> which if changed from the default <code>FALSE</code> to <code>TRUE</code> will return only the most commonly used colourimetrics <span class="citation">(Andersson and Prager 2006)</span>. <code>summary</code> can also take a vector of colour variable names, which can be used to filter the results</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(spec.sm, <span class="dt">subset =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># Extract only brightness variables</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(spec.sm, <span class="dt">subset =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'B1'</span>, <span class="st">'B2'</span>, <span class="st">'B3'</span>))</a></code></pre></div>
</div>
<div id="peak-shape-descriptors" class="section level3">
<h3 class="hasAnchor">
<a href="#peak-shape-descriptors" class="anchor"></a>Peak Shape Descriptors</h3>
<p>Particularly in cases of reflectance spectra that have multiple discrete peaks (in which case the <code>summary</code> function will only return variables based on the tallest peak in the curve), it might be useful to obtain variables that describe individual peak’s properties. The <code><a href="../reference/peakshape.html">peakshape()</a></code> function identifies the peak location (<code>H1</code>), returns the reflectance at that point (<code>B3</code>), and identifies the wavelengths at which the reflectance is half that at the peak, calculating the wavelength bandwidth of that interval (the Full Width at Half Maximum, or <code>FWHM</code>). The function also returns the half widths, which are useful when the peaks are located near the edge of the measurement limit and half maximum reflectance can only be reliably estimated from one of its sides.</p>
<p>If this all sounds too esoteric, fear not: <code><a href="../reference/peakshape.html">peakshape()</a></code> has the option of returning plots indicating what it’s calculating. The vertical continuous red line indicates the peak location, the horizontal continuous red line indicates the half-maximum reflectance, and the distance between the dashed lines (<code>HWHM.l</code> and <code>HWHM.r</code>) is the FWHM:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="../reference/peakshape.html">peakshape</a></span>(spec.sm, <span class="dt">plot =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-7-1.png" alt="Plots from `peakshape`" width="480"><p class="caption">
Plots from <code>peakshape</code>
</p>
</div>
<pre><code>##         id       B3  H1 FWHM HWHM.l HWHM.r incl.min
## 1 cardinal 52.70167 700   NA    114     NA      Yes
## 2   jacana 53.78744 700   NA    172     NA      Yes
## 3   oriole 54.15508 700   NA    149     NA      Yes
## 4 parakeet 29.86504 572  126     63     63      Yes
## 5    robin 37.85542 700   NA    107     NA      Yes
## 6  tanager 30.48108 557  166     81     85      Yes</code></pre>
<p>As it can be seen, the variable FWHM is meaningless if the curve doesn’t have a clear peak. Sometimes, such as in the case of the Cardinal (Above figure, first panel), there might be a peak which is not the point of maximum reflectance of the entire spectral curve. <code><a href="../reference/peakshape.html">peakshape()</a></code> also offers a <code>select</code> argument to facilitate subsetting the spectra data frame to, for example, focus on a single reflectance peak:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="../reference/peakshape.html">peakshape</a></span>(spec.sm, <span class="dt">select =</span> <span class="dv">2</span>, <span class="dt">lim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">300</span>, <span class="dv">500</span>), <span class="dt">plot =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-8-1.png" alt="Plot from `peakshape`, setting the wavelength limits to 300 and 500 nm" width="480"><p class="caption">
Plot from <code>peakshape</code>, setting the wavelength limits to 300 and 500 nm
</p>
</div>
<pre><code>##         id       B3  H1 FWHM HWHM.l HWHM.r incl.min
## 1 cardinal 17.84381 369  100     46     54      Yes</code></pre>
</div>
</div>
<div id="visual-modelling" class="section level2">
<h2 class="hasAnchor">
<a href="#visual-modelling" class="anchor"></a>Visual Modelling</h2>
<div id="overview-1" class="section level3">
<h3 class="hasAnchor">
<a href="#overview-1" class="anchor"></a>Overview</h3>
<p>All visual and colourspace modelling and plotting options are wrapped into four main function: <code><a href="../reference/vismodel.html">vismodel()</a></code>, <code><a href="../reference/colspace.html">colspace()</a></code>, <code><a href="../reference/coldist.html">coldist()</a></code>, and <code>plot</code>. As detailed below, these functions cover the basic processes common to most modelling approaches. Namely, the estimation of quantum catches, their conversion to an appropriate space, estimating the distances between samples, and visualising the results. As a brief example, a typical workflow for modelling might use:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/vismodel.html">vismodel()</a></code> to estimate photoreceptor quantum catches. The assumptions of visual models may differ dramatically, so be sure to select options that are appropriate for your intended use.</li>
<li>
<code><a href="../reference/colspace.html">colspace()</a></code> to convert the results of <code><a href="../reference/vismodel.html">vismodel()</a></code> (or user-provided quantum catches) into points in a given colourspace, specified with the <code>space</code> argument. If no <code>space</code> argument is provided, <code><a href="../reference/colspace.html">colspace()</a></code> will automatically select the di-, tri- or tetrahedral colourspace, depending on the nature of the input data. The result of <code><a href="../reference/colspace.html">colspace()</a></code> will be an object of class <code>colspace</code> (that inherits from <code>data.frame</code>), and will contain the location of stimuli in the selected space along with any associated colour variables.</li>
<li>
<code><a href="../reference/coldist.html">coldist()</a></code> to estimate the colour distances between points in a colourspace (if the input is from <code>colspace</code>), or the ‘perceptual’, noise-weighted distances in the receptor-noise limited model (if the input is from <code><a href="../reference/vismodel.html">vismodel()</a></code> where <code>relative = FALSE</code>).</li>
<li>
<code>plot</code> the output. <code>plot</code> will automatically select the appropriate visualisation based on the input <code>colspace</code> object, and will also accept various graphical parameters depending on the colourspace (see <code><a href="../reference/plot.colspace.html">?plot.colspace</a></code> and links therein for details).</li>
</ol>
</div>
<div id="accessing-and-plotting-in-built-spectral-data" class="section level3">
<h3 class="hasAnchor">
<a href="#accessing-and-plotting-in-built-spectral-data" class="anchor"></a>Accessing and Plotting In-built Spectral Data</h3>
<p>All in-built spectral data in <code>pavo</code> can be easily retrieved and/or plotted via the <code><a href="../reference/sensdata.html">sensdata()</a></code> function. These data can be visualised directly by including <code>plot = TRUE</code>, or assigned to an object for subsequent use, as in:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">musca_sense &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sensdata.html">sensdata</a></span>(<span class="dt">visual =</span> <span class="st">"musca"</span>, <span class="dt">achromatic =</span> <span class="st">"md.r1"</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(musca_sense)</a></code></pre></div>
<pre><code>##    wl    musca.u     musca.s     musca.m     musca.l       md.r1
## 1 300 0.01148992 0.006726680 0.001533875 0.001524705 0.001713692
## 2 301 0.01152860 0.006749516 0.001535080 0.001534918 0.001731120
## 3 302 0.01156790 0.006773283 0.001536451 0.001545578 0.001751792
## 4 303 0.01160839 0.006798036 0.001537982 0.001556695 0.001775960
## 5 304 0.01165060 0.006823827 0.001539667 0.001568283 0.001803871
## 6 305 0.01169510 0.006850712 0.001541499 0.001580352 0.001835777</code></pre>
</div>
<div id="visual-phenotypes" class="section level3">
<h3 class="hasAnchor">
<a href="#visual-phenotypes" class="anchor"></a>Visual Phenotypes</h3>
<p><code>pavo</code> contains numerous di-, tri- and tetrachromatic visual systems, to accompany the suite of new models. The full complement of included systems are accessible via the <code><a href="../reference/vismodel.html">vismodel()</a></code> argument <code>visual</code>, and include:</p>
<table class="table">
<caption>Built-in visual phenotypes available in pavo</caption>
<thead><tr class="header">
<th align="left">phenotype</th>
<th align="left">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">avg.uv</td>
<td align="left">average ultraviolet-sensitive avian (tetrachromat)</td>
</tr>
<tr class="even">
<td align="left">avg.v</td>
<td align="left">average violet-sensitive avian (tetrachromat)</td>
</tr>
<tr class="odd">
<td align="left">bluetit</td>
<td align="left">The blue tit <em>Cyanistes caeruleus</em> (tetrachromat)</td>
</tr>
<tr class="even">
<td align="left">star</td>
<td align="left">The starling <em>Sturnus vulgaris</em> (tetrachromat)</td>
</tr>
<tr class="odd">
<td align="left">pfowl</td>
<td align="left">The peafowl <em>Pavo cristatus</em> (tetrachromat)</td>
</tr>
<tr class="even">
<td align="left">apis</td>
<td align="left">The honeybee <em>Apis mellifera</em> (trichromat)</td>
</tr>
<tr class="odd">
<td align="left">ctenophorus</td>
<td align="left">The ornate dragon lizard <em>Ctenophorus ornatus</em> (trichromat)</td>
</tr>
<tr class="even">
<td align="left">canis</td>
<td align="left">The canid <em>Canis familiaris</em> (dichromat)</td>
</tr>
<tr class="odd">
<td align="left">musca</td>
<td align="left">The housefly <em>Musca domestica</em> (tetrachromat)</td>
</tr>
<tr class="even">
<td align="left">cie2</td>
<td align="left">2-degree colour matching functions for CIE models of human colour vision (trichromat)</td>
</tr>
<tr class="odd">
<td align="left">cie10</td>
<td align="left">10-degree colour matching functions for CIE models of human colour vision (trichromat)</td>
</tr>
<tr class="even">
<td align="left">segment</td>
<td align="left">A generic ‘viewer’ with broad sensitivities for use in the segment analysis of Endler (1990) (tetrachromat)</td>
</tr>
<tr class="odd">
<td align="left">habronattus</td>
<td align="left">The jumping spider <em>Habronattus pyrrithrix</em> (trichromat)</td>
</tr>
<tr class="even">
<td align="left">rhinecanthus</td>
<td align="left">The triggerfish <em>Rhinecanthus aculeatus</em> (trichromat)</td>
</tr>
</tbody>
</table>
</div>
<div id="estimating-quantum-catch" class="section level3">
<h3 class="hasAnchor">
<a href="#estimating-quantum-catch" class="anchor"></a>Estimating Quantum Catch</h3>
<p>Numerous models have been developed to understand how colours are perceived and discriminated by an individual’s or species’ visual system <span class="citation">(described in detail in Endler 1990; Renoult, Kelber, and Schaefer 2017; Vorobyev et al. 1998)</span>. In essence, these models take into account the receptor sensitivity of the different receptors that make the visual system in question and quantify how a given colour would stimulate those receptors individually, and their combined effect on the perception of colour. These models also have an important component of assuming and interpreting the chromatic component of colour (hue and saturation) to be processed independently of the achromatic (brightness, or luminance) component. This provides a flexible framework allowing for a tiered model construction, in which information on aspects such as different illumination sources, backgrounds, and visual systems can be considered and compared.</p>
<p>To apply any such model, we first need to quantify receptor excitation and then consider how the signal is being processed, while possibly considering the relative density of different cones and the noise-to-signal ratio.</p>
<p>To quantify the stimulation of cones by the emitted colour, we will use the <code>pavo</code> function <code><a href="../reference/vismodel.html">vismodel()</a></code>. This function takes an <code>rspec</code> dataframe as a minimal input, and the user can either select from the available options or input their own data for the additional arguments in the function:</p>
<ul>
<li>
<code>visual</code>: the visual system to be used. Available inbuilt options are detailed above, or the user may include their own dataframe, with the first column being the wavelength range and the following columns being the absorbance at each wavelength for each cone type (see below for an example).</li>
<li>
<code>achromatic</code>: Either a receptor’s sensitivity data (available options include the blue tit, chicken, and starling double-cones, and the housefly’s R1-6 receptor), which can also be user-defined as above; or the longest-wavelength receptor, the sum of the two longest-wavelength receptors, or the sum of all receptors can be used. Alternatively, <code>none</code> can be specified for no achromatic stimulation calculation.</li>
<li>
<code>illum</code>: The illuminant being considered. By default, it considers an ideal white illuminant, but implemented options are a blue sky, standard daylight, and forest shade illuminants. A vector of same length as the wavelength range being considered can also be used as the input.</li>
<li>
<code>trans</code>: Models of the effects of light transmission (e.g. through noisy environments or ocular filters). The argument defaults to <code>ideal</code> (i.e. no effect), though users can also use the built-in options of <code>bluetit</code> or <code>blackbird</code> to model the ocular transmission of blue tits/blackbirds, or specify a user-defined vector containing transmission spectra.</li>
<li>
<code>qcatch</code>: This argument determines what photon catch data should be returned
<ul>
<li>
<code>Qi</code>: The receptor quantum catches, calculated for receptor <span class="math inline">\(i\)</span> as: <span class="math display">\[Q_i = \int_\lambda{R_i(\lambda)S(\lambda)I(\lambda)d\lambda}\]</span> Where <span class="math inline">\(\lambda\)</span> denotes the wavelength, <span class="math inline">\(R_i(\lambda)\)</span> the spectral sensitivity of receptor <span class="math inline">\(i\)</span>, <span class="math inline">\(S(\lambda)\)</span> the reflectance spectrum of the colour, and <span class="math inline">\(I(\lambda)\)</span> the illuminant spectrum.</li>
<li>
<code>fi</code>: The receptor quantum catches transformed according to Fechner’s law, in which the signal of the receptor is proportional to the logarithm of the quantum catch i.e. <span class="math inline">\(f_i = \ln(Q_i)\)</span>
</li>
<li>
<code>Ei</code>: the hyperbolic transform (a simplification of the Michaelis–Menten photoreceptor equation), where <span class="math display">\[E_i = \frac{Q_i}{Q_i + 1}\]</span>.</li>
</ul>
</li>
<li>
<code>bkg</code>: The background being considered. By default, it considers an idealized background (i.e. wavelength-independent influence of the background on colour). A vector of same length as the wavelength range being considered can also be used as the input.</li>
<li>
<code>vonkries</code>: a logical argument which determines if the von Kries transformation (which normalizes receptor quantum catches to the background, thus accounting for receptor adaptation) is to be applied (defaults to <code>FALSE</code>). If <code>TRUE</code>, <span class="math inline">\(Q_i\)</span> is multiplied by a constant <span class="math inline">\(k\)</span>, which describes the von Kries transformation: <span class="math display">\[k_i = \frac{1}{\int_\lambda R_i(\lambda)S^b(\lambda)I(\lambda)d\lambda}\]</span> Where <span class="math inline">\(S^b\)</span> denotes the reflectance spectra of the background.</li>
<li>
<code>scale</code>: This argument defines how the illuminant should be scaled. The scale of the illuminant is critical of receptor noise models in which the signal intensity influences the noise (see Receptor noise section, below). Illuminant curves should be in units of <span class="math inline">\(\mu mol.s^{-1}.m^{-2}\)</span> in order to yield physiologically meaningful results. (Some software return illuminant information values in <span class="math inline">\(\mu Watt.cm^{-2}\)</span>, and must be converted to <span class="math inline">\(\mu mol.s^{-1}.m^{-2}\)</span>. This can be done by using the <code><a href="../reference/irrad2flux.html">irrad2flux()</a></code> and <code><a href="../reference/irrad2flux.html">flux2irrad()</a></code> functions.) Therefore, if the user-specified illuminant curves are <em>not</em> in these units (i.e. are measured proportional to a white standard, for example), the <code>scale</code> parameter can be used as a multiplier to yield curves that are at least a reasonable approximation of the illuminant value. Commonly used values are <strong>500</strong> for dim conditions and <strong>10,000</strong> for bright conditions.</li>
<li>
<code>relative</code>: If <code>TRUE</code>, it will make the cone stimulations relative to their sum. This is appropriate for colourspace models such as the avian tetrahedral colourspace <span class="citation">(Goldsmith 1990; Stoddard and Prum 2008)</span>. For the photon catch and neural noise model, it is important to set <code>relative = FALSE</code>.</li>
</ul>
<p>All visual models begin with the estimation of receptor quantum catches. The requirements of models may differ significantly of course, so be sure to consult the function documentation and original publications. For this example, we will use the average reflectance of the different species to calculate the raw stimulation of retinal cones, considering the avian average UV visual system, a standard daylight illumination, and an idealized background.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">vismod1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(sppspec,</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">  <span class="dt">visual =</span> <span class="st">"avg.uv"</span>, <span class="dt">achromatic =</span> <span class="st">"bt.dc"</span>,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">  <span class="dt">illum =</span> <span class="st">"D65"</span>, <span class="dt">relative =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">vismod1</a></code></pre></div>
<p>Since there are multiple parameters that can be used to customize the output of <code><a href="../reference/vismodel.html">vismodel()</a></code>, as detailed above, for convenience these can be returned by using <code>summary</code> in a <code>vismodel</code> object:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(vismod1)</a></code></pre></div>
<pre><code>## visual model options:
##  * Quantal catch: Qi 
##  * Visual system, chromatic: avg.uv 
##  * Visual system, achromatic: bt.dc 
##  * Illuminant: D65, scale = 1 (von Kries colour correction not applied) 
##  * Background: ideal 
##  * Transmission: ideal 
##  * Relative: FALSE</code></pre>
<pre><code>##        u                 s                 m                l         
##  Min.   :0.01093   Min.   :0.03749   Min.   :0.1297   Min.   :0.2171  
##  1st Qu.:0.01509   1st Qu.:0.06137   1st Qu.:0.1695   1st Qu.:0.2318  
##  Median :0.01925   Median :0.06353   Median :0.2595   Median :0.2866  
##  Mean   :0.02321   Mean   :0.08854   Mean   :0.2262   Mean   :0.3197  
##  3rd Qu.:0.03059   3rd Qu.:0.12753   3rd Qu.:0.2722   3rd Qu.:0.3969  
##  Max.   :0.04177   Max.   :0.15716   Max.   :0.2923   Max.   :0.4807  
##       lum        
##  Min.   :0.1501  
##  1st Qu.:0.1965  
##  Median :0.2194  
##  Mean   :0.2215  
##  3rd Qu.:0.2618  
##  Max.   :0.2755</code></pre>
<p>We can visualise what <code><a href="../reference/vismodel.html">vismodel()</a></code> is doing when estimating quantum catches by comparing the reflectance spectra to the estimates they are generating:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">6</span>), <span class="dt">oma =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/graphics/layout.html">layout</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">5</span>), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">5</span>), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">8</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">11</span>), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">7</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">9</span>, <span class="dv">11</span>, <span class="dv">11</span>)))</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">sppspecol &lt;-<span class="st"> </span><span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(sppspec)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5"></a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="dv">7</span>) {</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">  <span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">  <span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(sppspec, <span class="dt">select =</span> i, <span class="dt">col =</span> sppspecol, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">ylim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">100</span>))</a>
<a class="sourceLine" id="cb17-9" data-line-number="9">  <span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mar =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4.1</span>, <span class="fl">2.5</span>, <span class="fl">2.5</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb17-10" data-line-number="10">  <span class="kw"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(vismod1[i, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>]), <span class="dt">yaxt =</span> <span class="st">"n"</span>, <span class="dt">col =</span> <span class="st">"black"</span>)</a>
<a class="sourceLine" id="cb17-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb17-12" data-line-number="12"></a>
<a class="sourceLine" id="cb17-13" data-line-number="13"><span class="kw"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span>(<span class="st">"Wavelength (nm)"</span>, <span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">outer =</span> <span class="ot">TRUE</span>, <span class="dt">line =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="kw"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span>(<span class="st">"Reflectance (%)"</span>, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">outer =</span> <span class="ot">TRUE</span>, <span class="dt">line =</span> <span class="dv">1</span>)</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-13-1.png" alt="Plots of species mean reflectance curves with corresponding relative usml cone stimulations (insets)." width="576"><p class="caption">
Plots of species mean reflectance curves with corresponding relative usml cone stimulations (insets).
</p>
</div>
<p>As described above, <code>vismodel</code> also accepts user-defined visual systems, background and illuminants. We will illustrate this by showcasing the function <code>sensmodel</code>, which models spectral sensitivities of retinas based on their peak cone sensitivity, as described in <span class="citation">Govardovskii et al. (2000)</span> and <span class="citation">Hart and Vorobyev (2005)</span>. <code>sensmodel</code> takes several optional arguments, but the main one is a vector containing the peak sensitivities for the cones being modelled. Let’s model an idealized dichromat visual system, with cones peaking in sensitivity at 350 and 650 nm:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">idealizeddichromat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sensmodel.html">sensmodel</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">350</span>, <span class="dv">650</span>))</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(idealizeddichromat, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(idealizeddichromat), <span class="dt">ylab =</span> <span class="st">"Absorbance"</span>)</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-14-1.png" alt="Idealized dichromat photoreceptors created using `sensmodel`." width="480"><p class="caption">
Idealized dichromat photoreceptors created using <code>sensmodel</code>.
</p>
</div>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">vismod.idi &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(sppspec, <span class="dt">visual =</span> idealizeddichromat, <span class="dt">relative =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">vismod.idi</a></code></pre></div>
</div>
<div id="the-receptor-noise-model" class="section level3">
<h3 class="hasAnchor">
<a href="#the-receptor-noise-model" class="anchor"></a>The Receptor Noise Model</h3>
<p>The receptor-noise limited (RNL) model of <span class="citation">Vorobyev et al. (1998)</span>, <span class="citation">Vorobyev et al. (2001)</span> offers a basis for estimating the ‘perceptual’ distance between coloured stimuli (depending on available physiological and behavioural data), and assumes that the simultaneous discrimination of colours is fundamentally limited by photoreceptor noise. Colour distances under the RNL model can be calculated by using the inverse of the noise-to-signal ratio, known as the Weber fraction (<span class="math inline">\(w_i\)</span> for each cone <span class="math inline">\(i\)</span>). The Weber fraction can be calculated from the noise-to-signal ratio of cone <span class="math inline">\(i\)</span> (<span class="math inline">\(v_i\)</span>) and the relative number of receptor cells of type <span class="math inline">\(i\)</span> within the receptor field (<span class="math inline">\(n_i\)</span>):</p>
<p><span class="math display">\[w_i = \frac{v_i}{\sqrt{n_i}}\]</span></p>
<p><span class="math inline">\(w_i\)</span> is the value used for the noise when considering only neural noise mechanisms. Alternatively, the model can consider that the intensity of the colour signal itself contributes to the noise (photoreceptor, or quantum, noise). In this case, the noise for a receptor <span class="math inline">\(i\)</span> is calculated as:</p>
<p><span class="math display">\[w_i = \sqrt{\frac{v_i^2}{\sqrt{n_i}} + \frac{2}{Q_a+Q_b}}\]</span></p>
<p>where <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span> refer to the two colour signals being compared. Note that when the values of <span class="math inline">\(Q_a\)</span> and <span class="math inline">\(Q_b\)</span> are very high, the second portion of the equation tends to zero, and the both formulas should yield similar results. Hence, it is important that the quantum catch are calculated in the appropriate illuminant scale, as described above.</p>
<p>Colour distances are obtained by weighting the Euclidean distance of the photoreceptor quantum catches by the Weber fraction of the cones (<span class="math inline">\(\Delta S\)</span>). These measurements are in units of Just Noticeable Differences (JNDs), where distances over a certain threshold (usually 1) are considered to be discernible under the conditions considered (e.g., backgrounds, illumination). The equations used in these calculations are:</p>
<p>For dichromats: <span class="math display">\[\Delta S = \sqrt{\frac{(\Delta f_1 - \Delta f_2)^2}{w_1^2+w_2^2}}\]</span></p>
<p>For trichromats: <span class="math display">\[\Delta S = \sqrt{\frac{w_1^2(\Delta f_3 - \Delta f_2)^2 + w_2^2(\Delta f_3 - \Delta f_1)^2 +
w_3^2(\Delta f_1 - \Delta f_2)^2 }{ (w_1w_2)^2 + (w_1w_3)^2 + (w_2w_3)^2 }}\]</span></p>
<p>For tetrachromats: <span class="math display">\[\Delta S =
\sqrt{(w_1w_2)^2(\Delta f_4 - \Delta f_3)^2 + (w_1w_3)^2(\Delta f_4 - \Delta f_2)^2 +
(w_1w_4)^2(\Delta f_3 - \Delta f_2)^2 + \\ (w_2w_3)^2(\Delta f_4 - \Delta f_1)^2 +
(w_2w_4)^2(\Delta f_3 - \Delta f_1)^2 + (w_3w_4)^2(\Delta f_2 - \Delta f_1)^2 / \\
((w_1w_2w_3)^2 + (w_1w_2w_4)^2 + (w_1w_3w_4)^2 + (w_2w_3w_4)^2)}\]</span></p>
<p>For the chromatic contrast. The achromatic contrast (<span class="math inline">\(\Delta L\)</span>) can be calculated based on the double cone or the receptor (or combination of receptors) responsible for chromatic processing by the equation:</p>
<p><span class="math display">\[\Delta L = \frac{\Delta f}{w}\]</span></p>
<div id="perceptual-distances-with-coldist" class="section level4">
<h4 class="hasAnchor">
<a href="#perceptual-distances-with-coldist" class="anchor"></a>Perceptual Distances with <code>coldist()</code>
</h4>
<p><code>pavo</code> implements the noise-weighted colour distance calculations in the function <code><a href="../reference/coldist.html">coldist()</a></code>, assuming that raw receptor quantum catches are provided (via <code>relative = FALSE</code> in <code><a href="../reference/vismodel.html">vismodel()</a></code>). For the achromatic contrast, <code><a href="../reference/coldist.html">coldist()</a></code> uses <code>n4</code> to calculate <span class="math inline">\(w\)</span> for the achromatic contrast. Note that even if <span class="math inline">\(Q_i\)</span> is chosen, values are still log-transformed. This option is available in case the user wants to specify a data frame of quantum catches that was not generated by <code><a href="../reference/vismodel.html">vismodel()</a></code> as an input. In this case, the argument <code>qcatch</code> should be used to inform the function if <span class="math inline">\(Q_i\)</span> or <span class="math inline">\(f_i\)</span> values are being used (note that if the input to <code><a href="../reference/coldist.html">coldist()</a></code> is an object generated using the <code><a href="../reference/vismodel.html">vismodel()</a></code> function, this argument is ignored.) The type of noise to be calculated can be selected from the <code><a href="../reference/coldist.html">coldist()</a></code> argument <code>noise</code> (which accepts either <code>"neural"</code> or <code>"quantum"</code>).</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="../reference/coldist.html">coldist</a></span>(vismod1,</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">  <span class="dt">noise =</span> <span class="st">"neural"</span>, <span class="dt">achromatic =</span> <span class="ot">TRUE</span>, <span class="dt">n =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">  <span class="dt">weber =</span> <span class="fl">0.1</span>, <span class="dt">weber.achro =</span> <span class="fl">0.1</span></a>
<a class="sourceLine" id="cb20-4" data-line-number="4">)</a></code></pre></div>
<pre><code>## Calculating noise-weighted Euclidean distances and noise-weighted luminance contrasts</code></pre>
<pre><code>##      patch1   patch2        dS        dL
## 1  cardinal   jacana  8.423965 3.3449627
## 2  cardinal   oriole  7.905876 3.5110820
## 3  cardinal parakeet  7.999730 0.5177495
## 4  cardinal    robin  5.805562 2.5606167
## 5  cardinal  tanager 10.100311 1.9068807
## 6    jacana   oriole 10.151253 0.1661193
## 7    jacana parakeet  4.231570 2.8272132
## 8    jacana    robin  3.503769 5.9055794
## 9    jacana  tanager  5.126266 1.4380820
## 10   oriole parakeet  8.135793 2.9933325
## 11   oriole    robin  7.220505 6.0716987
## 12   oriole  tanager 13.608253 1.6042013
## 13 parakeet    robin  4.606847 3.0783661
## 14 parakeet  tanager  5.969760 1.3891312
## 15    robin  tanager  7.688707 4.4674974</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="../reference/coldist.html">coldist</a></span>(vismod.idi, <span class="dt">n =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">weber =</span> <span class="fl">0.1</span>)</a></code></pre></div>
<pre><code>## Calculating noise-weighted Euclidean distances</code></pre>
<pre><code>##      patch1   patch2        dS dL
## 1  cardinal   jacana 2.0993283 NA
## 2  cardinal   oriole 4.6567462 NA
## 3  cardinal parakeet 2.2575457 NA
## 4  cardinal    robin 3.7236780 NA
## 5  cardinal  tanager 3.5417700 NA
## 6    jacana   oriole 2.5574178 NA
## 7    jacana parakeet 4.3568740 NA
## 8    jacana    robin 1.6243496 NA
## 9    jacana  tanager 5.6410983 NA
## 10   oriole parakeet 6.9142918 NA
## 11   oriole    robin 0.9330682 NA
## 12   oriole  tanager 8.1985162 NA
## 13 parakeet    robin 5.9812236 NA
## 14 parakeet  tanager 1.2842244 NA
## 15    robin  tanager 7.2654480 NA</code></pre>
<p>Where <code>dS</code> is the chromatic contrast (<span class="math inline">\(\Delta S\)</span>) and <code>dL</code> is the achromatic contrast (<span class="math inline">\(\Delta L\)</span>). Note that, by default, <code>achromatic = FALSE</code>, so <code>dL</code> isn’t included in the second result (this is to maintain consistency since, in the <code><a href="../reference/vismodel.html">vismodel()</a></code> function, the <code>achromatic</code> argument defaults to <code>none</code>). As expected, values are really high under the avian colour vision, since the colours of these species are quite different and because of the enhanced discriminatory ability with four compared to two cones.</p>
<p><code><a href="../reference/coldist.html">coldist()</a></code> also has a <code>subset</code> argument, which is useful if only certain comparisons are of interest (for example, of colour patches against a background, or only comparisons among a species or body patch). <code>subset</code> can be a vector of length one or two. If only one subsetting option is passed, all comparisons against the matching argument are returned (useful in the case of comparing to a background, for example). If two values are passed, comparisons will only be made between samples that match that rule (partial string matching and regular expressions are accepted). For example, compare:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw"><a href="../reference/coldist.html">coldist</a></span>(vismod1, <span class="dt">subset =</span> <span class="st">'cardinal'</span>)</a></code></pre></div>
<pre><code>## Calculating noise-weighted Euclidean distances</code></pre>
<pre><code>##     patch1   patch2        dS dL
## 1 cardinal   jacana  8.423965 NA
## 2 cardinal   oriole  7.905876 NA
## 3 cardinal parakeet  7.999730 NA
## 4 cardinal    robin  5.805562 NA
## 5 cardinal  tanager 10.100311 NA</code></pre>
<p>to:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw"><a href="../reference/coldist.html">coldist</a></span>(vismod1, <span class="dt">subset =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'cardinal'</span>, <span class="st">'jacana'</span>))</a></code></pre></div>
<pre><code>## Calculating noise-weighted Euclidean distances</code></pre>
<pre><code>##     patch1 patch2       dS dL
## 1 cardinal jacana 8.423965 NA</code></pre>
</div>
<div id="converting-receptor-noise-corrected-distances-to-cartesian-coordinates" class="section level4">
<h4 class="hasAnchor">
<a href="#converting-receptor-noise-corrected-distances-to-cartesian-coordinates" class="anchor"></a>Converting receptor noise-corrected distances to Cartesian coordinates</h4>
<p>You can convert distances in JND back to Cartesian position coordinates with the function <code><a href="../reference/jnd2xyz.html">jnd2xyz()</a></code>. Note that the actual position of these points in the XYZ space is arbitrary; therefore the function allows you to rotate the data so that, for example, the vector leading to the long-wavelength cone aligns with the X axis:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">fakedata1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span>(</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">100</span>, <span class="dv">500</span>, <span class="dt">by =</span> <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb32-3" data-line-number="3">  <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(</a>
<a class="sourceLine" id="cb32-4" data-line-number="4">      <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, x, <span class="dv">30</span>),</a>
<a class="sourceLine" id="cb32-5" data-line-number="5">      <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, x <span class="op">+</span><span class="st"> </span><span class="dv">400</span>, <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb32-6" data-line-number="6">    )),</a>
<a class="sourceLine" id="cb32-7" data-line-number="7">    <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>(<span class="dv">401</span>)</a>
<a class="sourceLine" id="cb32-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb32-9" data-line-number="9"></a>
<a class="sourceLine" id="cb32-10" data-line-number="10"><span class="co"># Creating idealized specs with varying saturation</span></a>
<a class="sourceLine" id="cb32-11" data-line-number="11">fakedata2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span>(</a>
<a class="sourceLine" id="cb32-12" data-line-number="12">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">500</span>, <span class="dv">300</span>, <span class="dv">150</span>, <span class="dv">105</span>, <span class="dv">75</span>, <span class="dv">55</span>, <span class="dv">40</span>, <span class="dv">30</span>),</a>
<a class="sourceLine" id="cb32-13" data-line-number="13">  <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, <span class="dv">550</span>, x),</a>
<a class="sourceLine" id="cb32-14" data-line-number="14">  <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>(<span class="dv">401</span>)</a>
<a class="sourceLine" id="cb32-15" data-line-number="15">)</a>
<a class="sourceLine" id="cb32-16" data-line-number="16"></a>
<a class="sourceLine" id="cb32-17" data-line-number="17">fakedata1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">wl =</span> <span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, fakedata1))</a></code></pre></div>
<pre><code>## wavelengths found in column 1</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">fakedata1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(fakedata1, <span class="st">"max"</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## Scaling spectra to a maximum value of 1</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">fakedata2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">wl =</span> <span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, fakedata2))</a></code></pre></div>
<pre><code>## wavelengths found in column 1</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">fakedata2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(fakedata2, <span class="st">"sum"</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## Scaling spectra to a total area of 1</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">fakedata2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(fakedata2, <span class="st">"min"</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## Scaling spectra to a minimum value of zero</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="co"># Converting reflectance to percentage</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2">fakedata1[, <span class="dv">-1</span>] &lt;-<span class="st"> </span>fakedata1[, <span class="dv">-1</span>] <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb42-3" data-line-number="3">fakedata2[, <span class="dv">-1</span>] &lt;-<span class="st"> </span>fakedata2[, <span class="dv">-1</span>] <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(fakedata2[, <span class="dv">-1</span>]) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb42-4" data-line-number="4"></a>
<a class="sourceLine" id="cb42-5" data-line-number="5"><span class="co"># Combining and converting to rspec</span></a>
<a class="sourceLine" id="cb42-6" data-line-number="6">fakedata.c &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">wl =</span> <span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, fakedata1[, <span class="dv">-1</span>], fakedata2[, <span class="dv">-1</span>])</a>
<a class="sourceLine" id="cb42-7" data-line-number="7">fakedata.c &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(fakedata.c)</a></code></pre></div>
<pre><code>## wavelengths found in column 1</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="co"># Visual model and colour distances</span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2">fakedata.vm &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(fakedata.c, <span class="dt">relative =</span> <span class="ot">FALSE</span>, <span class="dt">achromatic =</span> <span class="st">'all'</span>)</a>
<a class="sourceLine" id="cb44-3" data-line-number="3">fakedata.cd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/coldist.html">coldist</a></span>(fakedata.vm,</a>
<a class="sourceLine" id="cb44-4" data-line-number="4">  <span class="dt">noise =</span> <span class="st">"neural"</span>, <span class="dt">n =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb44-5" data-line-number="5">  <span class="dt">weber =</span> <span class="fl">0.1</span>, <span class="dt">achromatic =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb44-6" data-line-number="6">)</a></code></pre></div>
<pre><code>## Calculating noise-weighted Euclidean distances and noise-weighted luminance contrasts</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="co"># Converting to Cartesian coordinates</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2">fakedata.cc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/jnd2xyz.html">jnd2xyz</a></span>(fakedata.cd, <span class="dt">ref1 =</span> <span class="st">"l"</span>, <span class="dt">axis1 =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">ref2 =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb46-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(fakedata.cc)</a></code></pre></div>
<pre><code>##             x          y         z      lum
## X1 -26.165302   3.692783 -17.71718 1.430788
## X2 -11.212399  -2.085407 -27.97937 2.315951
## X3   3.076291  -7.441594 -37.76761 3.621349
## X4  16.523287 -12.475488 -46.33606 4.341465
## X5  25.812150 -17.848152 -40.71621 4.444027
## X6  31.912643 -23.368560 -24.79660 4.046863</code></pre>
<p>which you can then plot as well:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(fakedata.cc, <span class="dt">theta =</span> <span class="dv">55</span>, <span class="dt">phi =</span> <span class="dv">25</span>, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(fakedata.c))</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-21-1.png" alt="Spectral data in a receptor noise-corrected colourspace" width="384"><p class="caption">
Spectral data in a receptor noise-corrected colourspace
</p>
</div>
<p>The axes in this colourspace are in JND units. For more information on these functions, see <code><a href="../reference/jnd2xyz.html">?jnd2xyz</a></code>, <code><a href="../reference/jndrot.html">?jndrot</a></code> and <code><a href="../reference/jndplot.html">?jndplot</a></code>.</p>
</div>
</div>
<div id="colourspaces" class="section level3">
<h3 class="hasAnchor">
<a href="#colourspaces" class="anchor"></a>Colourspaces</h3>
<p>Another general, flexible representation of stimuli is the colour space model. In such approaches, photon catches are expressed in relative values (so that the quantum catches of all receptors involved in chromatic discrimination sum to 1). The maximum stimulation of each cone <span class="math inline">\(n\)</span> is placed at the vertex of a <span class="math inline">\((n-1)\)</span>-dimensional polygon that encompasses all theoretical colours that can be perceived by that visual system. For the avian visual system comprised of 4 cones, for example, all colours can be placed somewhere in the volume of a tetrahedron, in which each of the four vertices represents the maximum stimulation of that particular cone type.</p>
<p>Though these models do not account for receptor noise (and thus do not allow an estimate of JNDs), they presents several advantages. First, they make for a very intuitive representation of colour points accounting for attributes of the colour vision of the signal receiver. Second, they allow for the calculation of several interesting variables that represent colour. For example, hue can be estimated from the angle of the point relative to the xy plane (blue-green-red) and the z axis (UV); saturation can be estimated as the distance of the point from the achromatic centre.</p>
<p><code><a href="https://rdrr.io/r/utils/data.html">data(flowers)</a></code> is a new example dataset consisting of reflectance spectra from 36 Australian angiosperm species, which we’ll use to illustrate for the following colourspace modelling.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(flowers)</a>
<a class="sourceLine" id="cb49-2" data-line-number="2"></a>
<a class="sourceLine" id="cb49-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(flowers[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</a></code></pre></div>
<pre><code>##    wl Goodenia_heterophylla Goodenia_geniculata Goodenia_gracilis
## 1 300             1.7426387            1.918962         0.3638354
## 2 301             1.5724849            1.872966         0.3501921
## 3 302             1.4099808            1.828019         0.3366520
## 4 303             1.2547709            1.784152         0.3231911
## 5 304             1.1064997            1.741398         0.3097854
## 6 305             0.9648117            1.699792         0.2964107</code></pre>
<div id="di--tri--and-tetrachromatic-colourspaces" class="section level4">
<h4 class="hasAnchor">
<a href="#di--tri--and-tetrachromatic-colourspaces" class="anchor"></a>Di-, Tri-, and Tetrachromatic Colourspaces</h4>
<p><code>pavo</code> has extensive modelling and visualisation capabilities for generic di-, tri-, and tetra-chromatic spaces, uniting these approaches in a cohesive workflow. As with most colourspace models, we first estimate relative quantum catches with various assumptions by using the <code><a href="../reference/vismodel.html">vismodel()</a></code> function, before converting each set of values to a location in colourspace by using the <code>space</code> argument in <code><a href="../reference/colspace.html">colspace()</a></code> (the function can also be set to try to detect the dimensionality of the colourspace automatically). For di- tri- and tetrachromatic spaces, <code><a href="../reference/colspace.html">colspace()</a></code> calculates the coordinates of stimuli as:</p>
<p><strong>Dichromats:</strong> <span class="math display">\[x = \frac{1}{\sqrt{2}}(Q_l - Q_s)\]</span></p>
<p><strong>Trichromats:</strong> <span class="math display">\[x = \frac{1}{\sqrt{2}}(Q_l - Q_m)\]</span> <span class="math display">\[y = \frac{\sqrt{2}}{\sqrt{3}}(Q_s - \frac{Q_l + Q_m}{2})\]</span></p>
<p><strong>Tetrachromats:</strong> <span class="math display">\[x = \frac{1}{\sqrt{2}}(Q_l - Q_m)\]</span> <span class="math display">\[y = \frac{\sqrt{2}}{\sqrt{3}}(Q_s - \frac{Q_l + Q_m}{2})\]</span> <span class="math display">\[z = \frac{\sqrt{3}}{2}(Q_u - \frac{Q_l + Q_m + Q_s}{3})\]</span></p>
<p>Where Q<sub>u</sub>, Q<sub>s</sub>, Q<sub>m</sub>, and Q<sub>l</sub> refer to quantum catch estimates for UV-, short, medium-, and long-wavelength photoreceptors, respectively.</p>
<p>For a dichromatic example, we can model our floral reflectance data using the visual system of the domestic dog <em>Canis familiaris</em>, which has two cones with maximal sensitivity near 440 and 560 nm.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> <span class="st">'canis'</span>)</a>
<a class="sourceLine" id="cb51-2" data-line-number="2"></a>
<a class="sourceLine" id="cb51-3" data-line-number="3">di.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">'di'</span>)</a>
<a class="sourceLine" id="cb51-4" data-line-number="4"></a>
<a class="sourceLine" id="cb51-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(di.flowers)</a></code></pre></div>
<pre><code>##                                s         l           x      r.vec lum
## Goodenia_heterophylla 0.52954393 0.4704561 -0.04178143 0.04178143  NA
## Goodenia_geniculata   0.25430150 0.7456985  0.34747015 0.34747015  NA
## Goodenia_gracilis     0.01747832 0.9825217  0.68238870 0.68238870  NA
## Xyris_operculata      0.39433933 0.6056607  0.14942675 0.14942675  NA
## Eucalyptus_sp         0.40628552 0.5937145  0.13253229 0.13253229  NA
## Faradaya_splendida    0.23166580 0.7683342  0.37948187 0.37948187  NA</code></pre>
<p>The output contains values for the relative stimulation of short- and long-wavelength sensitive photoreceptors associated with each flower, along with its single coordinate in dichromatic space and its r.vector (distance from the origin). To visualise where these points lie, we can simply plot them on a segment.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(di.flowers, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(flowers))</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-24-1.png" alt="Flowers in a dichromatic colourspace, as modelled according to a canid visual system." width="384"><p class="caption">
Flowers in a dichromatic colourspace, as modelled according to a canid visual system.
</p>
</div>
<p>For our trichromatic viewer we can use the honeybee <em>Apis mellifera</em>, one of the most significant and widespread pollinators. We’ll also transform our quantum catches according to Fechner’s law by specifying <code>qcatch = 'fi'</code>, and will model photoreceptor stimulation under bright conditions by scaling our illuminant with the <code>scale</code> argument.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> <span class="st">'apis'</span>, <span class="dt">qcatch =</span> <span class="st">'fi'</span>, <span class="dt">scale =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb54-2" data-line-number="2"></a>
<a class="sourceLine" id="cb54-3" data-line-number="3">tri.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">'tri'</span>)</a>
<a class="sourceLine" id="cb54-4" data-line-number="4"></a>
<a class="sourceLine" id="cb54-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(tri.flowers)</a></code></pre></div>
<pre><code>##                               s         m         l            x
## Goodenia_heterophylla 0.2882383 0.3587254 0.3530363 -0.004022828
## Goodenia_geniculata   0.2475326 0.3549832 0.3974842  0.030052720
## Goodenia_gracilis     0.1373117 0.3125304 0.5501579  0.168028001
## Xyris_operculata      0.2395035 0.3729820 0.3875145  0.010275990
## Eucalyptus_sp         0.2760091 0.3548096 0.3691813  0.010162377
## Faradaya_splendida    0.2654951 0.3431266 0.3913783  0.034119147
##                                 y    h.theta      r.vec lum
## Goodenia_heterophylla -0.05522995 -1.6435057 0.05537626  NA
## Goodenia_geniculata   -0.10508396 -1.2922439 0.10929687  NA
## Goodenia_gracilis     -0.24007647 -0.9601417 0.29303604  NA
## Xyris_operculata      -0.11491764 -1.4816131 0.11537616  NA
## Eucalyptus_sp         -0.07020755 -1.4270471 0.07093922  NA
## Faradaya_splendida    -0.08308452 -1.1811377 0.08981733  NA</code></pre>
<p>As in the case of our dichromat, the output contains relative photoreceptor stimulations, coordinates in the Maxwell triangle, as well as the ‘hue angle’ <code>h.theta</code> and distance from the origin (<code>r.vec</code>).</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(tri.flowers, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(flowers))</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-26-1.png" alt="Floral reflectance in a Maxwell triangle, considering a honeybee visual system." width="384"><p class="caption">
Floral reflectance in a Maxwell triangle, considering a honeybee visual system.
</p>
</div>
<p>Finally, we’ll draw on the blue tit’s visual system to model our floral reflectance spectra in a tetrahedral space, again using log-transformed quantum catches and assuming bright viewing conditions.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> <span class="st">"bluetit"</span>, <span class="dt">qcatch =</span> <span class="st">"fi"</span>, <span class="dt">scale =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb57-2" data-line-number="2"></a>
<a class="sourceLine" id="cb57-3" data-line-number="3">tetra.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">"tcs"</span>)</a>
<a class="sourceLine" id="cb57-4" data-line-number="4"></a>
<a class="sourceLine" id="cb57-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(tetra.flowers)</a></code></pre></div>
<pre><code>##                               u         s         m         l         u.r
## Goodenia_heterophylla 0.2274310 0.2659669 0.2524170 0.2541851 -0.02256897
## Goodenia_geniculata   0.1625182 0.2721621 0.2828016 0.2825182 -0.08748184
## Goodenia_gracilis     0.0428552 0.2443091 0.3504414 0.3623943 -0.20714480
## Xyris_operculata      0.1766234 0.2709785 0.2642637 0.2881344 -0.07337659
## Eucalyptus_sp         0.2118481 0.2609468 0.2637023 0.2635028 -0.03815190
## Faradaya_splendida    0.1844183 0.2557660 0.2786393 0.2811764 -0.06558169
##                                s.r         m.r         l.r            x
## Goodenia_heterophylla  0.015966893 0.002417012 0.004185066 -0.007214866
## Goodenia_geniculata    0.022162064 0.032801599 0.032518179  0.006341799
## Goodenia_gracilis     -0.005690920 0.100441373 0.112394348  0.072312163
## Xyris_operculata       0.020978454 0.014263689 0.038134446  0.010505857
## Eucalyptus_sp          0.010946788 0.013702317 0.013502794  0.001565228
## Faradaya_splendida     0.005765955 0.028639328 0.031176408  0.015560661
##                                  y           z    h.theta     h.phi
## Goodenia_heterophylla -0.005415708 -0.02256897 -2.4976873 -1.190529
## Goodenia_geniculata    0.003861848 -0.08748184  0.5469755 -1.486123
## Goodenia_gracilis      0.033297418 -0.20714480  0.4315247 -1.203879
## Xyris_operculata      -0.010813615 -0.07337659 -0.7998327 -1.368146
## Eucalyptus_sp          0.001044768 -0.03815190  0.5885699 -1.521510
## Faradaya_splendida     0.007189965 -0.06558169  0.4328380 -1.315140
##                            r.vec     r.max r.achieved lum
## Goodenia_heterophylla 0.02430520 0.2692325 0.09027589  NA
## Goodenia_geniculata   0.08779638 0.2508989 0.34992737  NA
## Goodenia_gracilis     0.22191605 0.2678272 0.82857920  NA
## Xyris_operculata      0.07490949 0.2552227 0.29350636  NA
## Eucalyptus_sp         0.03819828 0.2503039 0.15260760  NA
## Faradaya_splendida    0.06778487 0.2583986 0.26232676  NA</code></pre>
<p>Tetrahedral data (via <code><a href="../reference/colspace.html">colspace(space = 'tcs')</a></code>) may be plotted in a standard <em>static</em> tetrahedron by using <code><a href="https://rdrr.io/r/graphics/plot.html">plot()</a></code>, or can be visualised as part of an <em>interactive</em> tetrahedron by using <code><a href="../reference/tcsplot.html">tcsplot()</a></code> with the accessory functions <code><a href="../reference/tcsplot.html">tcspoints()</a></code> and <code><a href="../reference/tcsplot.html">tcsvol()</a></code> for adding points and convex hulls, respectively. As with other colourspace plots there are a number of associated graphical options, though the <code>theta</code> and <code>phi</code> arguments are particularly useful in this case, as they control the orientation (in degrees) of the tetrahedron in the xy and yz planes, respectively.</p>
<p>When plotting the tetrahedral colourspace, one can also force perspective by changing the size of points relative to their distance from the plane of observation, using the arguments <code>perspective = TRUE</code> and controlling the size range with the <code>range</code> argument. Several other options control the appearance of this plot, you can check these using <code><a href="../reference/plot.colspace.html">?plot.colspace</a></code> or <code><a href="../reference/tetraplot.html">?tetraplot</a></code></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(tetra.flowers, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(flowers), <span class="dt">perspective =</span> <span class="ot">TRUE</span>, <span class="dt">range =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">cex =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-28-1.png" alt="Flowers in a tetrahedral colourspace modelled using the visual phenotype of the blue tit. Point size is used to force perspective" width="480"><p class="caption">
Flowers in a tetrahedral colourspace modelled using the visual phenotype of the blue tit. Point size is used to force perspective
</p>
</div>
<p>Two additional functions may help with tetrahedral colourspace plotting:</p>
<ul>
<li>
<code><a href="../reference/axistetra.html">axistetra()</a></code> function can be used to draw arrows showing the direction and magnitude of distortion of x, y and z in the tetrahedral plot.</li>
<li>
<code><a href="../reference/legendtetra.html">legendtetra()</a></code> allows you to add a legend to a plot.</li>
</ul>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">pty =</span> <span class="st">"s"</span>)</a>
<a class="sourceLine" id="cb60-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(tetra.flowers, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(flowers))</a>
<a class="sourceLine" id="cb60-3" data-line-number="3"><span class="kw"><a href="../reference/axistetra.html">axistetra</a></span>(<span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="fl">1.8</span>)</a>
<a class="sourceLine" id="cb60-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(tetra.flowers, <span class="dt">theta =</span> <span class="dv">110</span>, <span class="dt">phi =</span> <span class="dv">10</span>, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(flowers))</a>
<a class="sourceLine" id="cb60-5" data-line-number="5"><span class="kw"><a href="../reference/axistetra.html">axistetra</a></span>(<span class="dt">x =</span> <span class="dv">0</span>, <span class="dt">y =</span> <span class="fl">1.8</span>)</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-29-1.png" alt="Flowers in a tetrahedral colourspace, with varied orientations and perspectives, modelled using the visual phenotype of the blue tit." width="576"><p class="caption">
Flowers in a tetrahedral colourspace, with varied orientations and perspectives, modelled using the visual phenotype of the blue tit.
</p>
</div>
<p>For tetrahedral models, another plotting option available is <code>projplot</code>, which projects colour points in the surface of a sphere encompassing the tetrahedron. This plot is particularly useful to see differences in hue.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1"><span class="kw"><a href="../reference/projplot.html">projplot</a></span>(tetra.flowers, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(flowers))</a></code></pre></div>
<pre><code>## Warning in seq.default(lim[1], lim[2], len = 100): partial argument match
## of 'len' to 'length.out'</code></pre>
<pre><code>## Warning in seq.default(lim[3], lim[4], len = 100): partial argument match
## of 'len' to 'length.out'</code></pre>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-30-1.png" alt="Projection plot from a tetrahedral colour space." width="480"><p class="caption">
Projection plot from a tetrahedral colour space.
</p>
</div>
<p>Finally, a useful function for tri- and tetrahedral models is <code><a href="../reference/voloverlap.html">voloverlap()</a></code>, which calculates the overlap in tri- or tetrahedral colour volume between two sets of points. This can be useful to explore whether different species occupy similar (overlapping) or different (non- overlapping) “sensory niches”, or to test for mimetism, dichromatism, etc. <span class="citation">(Stoddard and Stevens 2011)</span>. To show this function, we will use the <code>sicalis</code> dataset, which includes measurements from the crown (C), throat (T) and breast (B) of seven stripe-tailed yellow finches (<em>Sicalis citrina</em>).</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(sicalis)</a></code></pre></div>
<p>We will use this dataset to test for the overlap between the volume determined by the measurements of those body parts from multiple individuals in the tetrahedral colourspace (note the option <code>plot</code> for plotting of the volumes):</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">pty =</span> <span class="st">"s"</span>)</a>
<a class="sourceLine" id="cb65-2" data-line-number="2">tcs.sicalis.C &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw"><a href="../reference/colspace.html">colspace</a></span>(<span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(sicalis)), <span class="st">"C"</span>)</a>
<a class="sourceLine" id="cb65-3" data-line-number="3">tcs.sicalis.T &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw"><a href="../reference/colspace.html">colspace</a></span>(<span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(sicalis)), <span class="st">"T"</span>)</a>
<a class="sourceLine" id="cb65-4" data-line-number="4">tcs.sicalis.B &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw"><a href="../reference/colspace.html">colspace</a></span>(<span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(sicalis)), <span class="st">"B"</span>)</a>
<a class="sourceLine" id="cb65-5" data-line-number="5"><span class="kw"><a href="../reference/voloverlap.html">voloverlap</a></span>(tcs.sicalis.T, tcs.sicalis.B, <span class="dt">plot =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##           vol1         vol2   overlapvol vsmallest      vboth
## 1 5.183721e-06 6.281511e-06 6.904074e-07 0.1331876 0.06407598</code></pre>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1"><span class="kw"><a href="../reference/voloverlap.html">voloverlap</a></span>(tcs.sicalis.T, tcs.sicalis.C, <span class="dt">plot =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="pavo-3-analysing_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<pre><code>##           vol1         vol2 overlapvol vsmallest vboth
## 1 5.183721e-06 4.739152e-06          0         0     0</code></pre>
<p>The function <code><a href="../reference/voloverlap.html">voloverlap()</a></code> gives the volume (<span class="math inline">\(V\)</span>) of the convex hull delimited by the overlap between the two original volumes, and two proportions are calculated from that: <span class="math display">\[\text{vsmallest} = V_{overlap} / \min(V_A, V_B)\]</span> and <span class="math display">\[\text{vboth} = V_{overlap} / (V_A + V_B)\]</span>. Thus, if one of the volumes is entirely contained in the other, <code>vsmallest</code> will equal 1.</p>
<p>So we can clearly see that there is overlap between the throat and breast colours (of about 6%), but not between the throat and the crown colours (Figures above).</p>
<p><strong>Summary variables for groups of points</strong></p>
<p>Another advantage of colourspace models is that they allow for the calculation of useful summary statistics of groups of points, such as the centroid of the points, the total volume occupied, the mean and variance of hue span and the mean saturation. In <code>pavo</code>, the result of a <code><a href="../reference/colspace.html">colspace()</a></code> call is an object of class <code>colspace</code>, and thus these summary statistics can be calculated simply by calling <code>summary</code>. Note that the <code>summary</code> call can also take a <code>by</code> vector of group identities, so that the variables are calculated for each group separately:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(tetra.flowers)</a></code></pre></div>
<pre><code>## Colorspace &amp; visual model options:
##  * Colorspace: tcs 
##  * Quantal catch: fi 
##  * Visual system, chromatic: bluetit 
##  * Visual system, achromatic: none 
##  * Illuminant: ideal, scale = 10000 (von Kries colour correction not applied) 
##  * Background: ideal 
##  * Relative: TRUE 
## </code></pre>
<pre><code>##            centroid.u centroid.s centroid.m centroid.l        c.vol
## all.points  0.1948478  0.2554421  0.2704411   0.279269 0.0002510915
##              rel.c.vol  colspan.m   colspan.v huedisp.m huedisp.v
## all.points 0.001159742 0.05706825 0.001682224 0.6413439 0.3157949
##              mean.ra    max.ra
## all.points 0.2428508 0.8285792</code></pre>
</div>
<div id="the-colour-hexagon" class="section level4">
<h4 class="hasAnchor">
<a href="#the-colour-hexagon" class="anchor"></a>The Colour Hexagon</h4>
<p>The hexagon colour space of <span class="citation">Chittka (1992)</span> is a generalised colour-opponent model of hymenopteran vision that has found extremely broad use, particularly in studies of bee-flower interactions. It’s also often broadly applied across hymenopteran species, because the photopigments underlying trichromatic vision in Hymenoptera appear to be quite conserved <span class="citation">(Briscoe and Chittka 2001)</span>. What’s particularly useful is that colour distances within the hexagon have been extensively validated against behaviour, and thus offer a relatively reliable measure of perceptual distance.</p>
<p>In the hexagon, photoreceptor quantum catches are typically hyperbolically transformed (and <code>pavo</code> will return a warning if the transform is not selected), and vonkries correction is often used used to model photoreceptor adaptation to a vegetation background. This can all now be specified in <code><a href="../reference/vismodel.html">vismodel()</a></code>. including the optional use of a ‘green’ vegetation background. Note that although this is a colourspace model, we specific <code>relative = FALSE</code> to return unnormalised quantum catches, as required for the model.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> <span class="st">'apis'</span>, <span class="dt">qcatch =</span> <span class="st">'Ei'</span>, <span class="dt">relative =</span> <span class="ot">FALSE</span>, <span class="dt">vonkries =</span> <span class="ot">TRUE</span>, <span class="dt">achromatic =</span> <span class="st">'l'</span>, <span class="dt">bkg =</span> <span class="st">'green'</span>)</a></code></pre></div>
<p>We can then apply the hexagon model in <code>colspace</code>, which will convert our photoreceptor ‘excitation values’ to coordinates in the hexagon according to:</p>
<p><span class="math display">\[x = \frac{\sqrt{3}}{2(E_g + E_{uv})}\]</span></p>
<p><span class="math display">\[y = E_b - 0.5(E_{uv} + E_g)\]</span></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1">hex.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">'hexagon'</span>)</a>
<a class="sourceLine" id="cb73-2" data-line-number="2"></a>
<a class="sourceLine" id="cb73-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(hex.flowers)</a></code></pre></div>
<pre><code>##                                s         m         l         x          y
## Goodenia_heterophylla 0.56572097 0.8237141 0.7053057 0.1208839  0.1882007
## Goodenia_geniculata   0.35761236 0.8176153 0.8670134 0.4411542  0.2053024
## Goodenia_gracilis     0.01888788 0.1622766 0.7810589 0.6600594 -0.2376968
## Xyris_operculata      0.21080752 0.7345122 0.6796464 0.4060263  0.2892853
## Eucalyptus_sp         0.55622758 0.8515289 0.8208038 0.2291297  0.1630132
## Faradaya_splendida    0.45855056 0.7828905 0.8565895 0.3447118  0.1253205
##                         h.theta     r.vec sec.fine sec.coarse       lum
## Goodenia_heterophylla  32.71320 0.2236793       30  bluegreen 0.1680153
## Goodenia_geniculata    65.04388 0.4865862       60  bluegreen 0.3548825
## Goodenia_gracilis     109.80467 0.7015541      100      green 0.2313678
## Xyris_operculata       54.53092 0.4985412       50  bluegreen 0.1518319
## Eucalyptus_sp          54.57024 0.2812005       50  bluegreen 0.2787543
## Faradaya_splendida     70.02119 0.3667853       70  bluegreen 0.3351008</code></pre>
<p>Again, the output includes the photoreceptor excitation values for short- medium- and long-wave sensitive photoreceptors, x and y coordinates, and measures of hue and saturation for each stimulus. The hexagon model also outputs two additional measures of of subjective ‘bee-hue’; <code>sec.fine</code> and <code>sec.coarse</code>. <code>sec.fine</code> describes the location of stimuli within one of 36 ‘hue sectors’ that are specified by radially dissecting the hexagon in 10-degree increments. <code>sec.coarse</code> follows a similar principle, though here the hexagon is divided into only five ‘bee-hue’ sectors: UV, UV-blue, blue, blue-green, green, and UV-green. These can easily be visualised by specifying <code>sectors = 'coarse</code> or <code>sectors = 'fine'</code> in a call to <code>plot</code> after modelling.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(hex.flowers, <span class="dt">sectors =</span> <span class="st">'coarse'</span>, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(flowers))</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-36-1.png" alt="Flowers as modelled in the hymenopteran colour hexagon of Chittka (1992), overlain with coarse bee-hue sectors." width="480"><p class="caption">
Flowers as modelled in the hymenopteran colour hexagon of Chittka (1992), overlain with coarse bee-hue sectors.
</p>
</div>
</div>
<div id="the-colour-opponent-coding-coc-space" class="section level4">
<h4 class="hasAnchor">
<a href="#the-colour-opponent-coding-coc-space" class="anchor"></a>The Colour Opponent Coding (COC) Space</h4>
<p>The colour opponent coding (coc) space is an earlier hymenopteran visual model <span class="citation">(Backhaus 1991)</span> which, although now seldom used in favour of the hexagon, may prove useful for comparative work. While the initial estimation of photoreceptor excitation is similar to that in the hexagon, the coc subsequently specifies <code>A</code> and <code>B</code> coordinates based on empirically-derived weights for the output from each photoreceptor:</p>
<p><span class="math display">\[A = -9.86E_u + 7.70E_b + 2.16E_g\]</span> <span class="math display">\[B = -5.17E_u + 20.25E_b - 15.08E_g\]</span></p>
<p>Where <span class="math inline">\(E_i\)</span> is the excitation value (hyperbolic-transformed quantum catch) in photoreceptor <span class="math inline">\(i\)</span>.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> <span class="st">"apis"</span>, <span class="dt">qcatch =</span> <span class="st">"Ei"</span>, <span class="dt">relative =</span> <span class="ot">FALSE</span>, <span class="dt">vonkries =</span> <span class="ot">TRUE</span>, <span class="dt">bkg =</span> <span class="st">"green"</span>)</a>
<a class="sourceLine" id="cb76-2" data-line-number="2"></a>
<a class="sourceLine" id="cb76-3" data-line-number="3">coc.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">"coc"</span>)</a>
<a class="sourceLine" id="cb76-4" data-line-number="4"></a>
<a class="sourceLine" id="cb76-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(coc.flowers)</a></code></pre></div>
<pre><code>##                                s         m         l        x          y
## Goodenia_heterophylla 0.56572097 0.8237141 0.7053057 2.288050  3.1194224
## Goodenia_geniculata   0.35761236 0.8176153 0.8670134 4.642329  1.6332926
## Goodenia_gracilis     0.01888788 0.1622766 0.7810589 2.750382 -8.5899171
## Xyris_operculata      0.21080752 0.7345122 0.6796464 5.045218  3.5349309
## Eucalyptus_sp         0.55622758 0.8515289 0.8208038 2.845304  1.9900420
## Faradaya_splendida    0.45855056 0.7828905 0.8565895 3.357182  0.5654568
##                           r.vec lum
## Goodenia_heterophylla  5.407473  NA
## Goodenia_geniculata    6.275622  NA
## Goodenia_gracilis     11.340299  NA
## Xyris_operculata       8.580149  NA
## Eucalyptus_sp          4.835346  NA
## Faradaya_splendida     3.922638  NA</code></pre>
<p>The A and B coordinates are designated x and y in the output of coc for consistency, and while the model includes a measure of saturation in <code>r.vec</code>, it contains no associated measure of hue.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(coc.flowers, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(flowers), <span class="dt">yaxt =</span> <span class="st">"n"</span>)</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-38-1.png" alt="Flowers in the colour-opponent-coding space of Backhaus (1991), as modelling according to the honeybee." width="480"><p class="caption">
Flowers in the colour-opponent-coding space of Backhaus (1991), as modelling according to the honeybee.
</p>
</div>
</div>
<div id="cie-spaces" class="section level4">
<h4 class="hasAnchor">
<a href="#cie-spaces" class="anchor"></a>CIE Spaces</h4>
<p>The CIE (International Commission on Illumination) colourspaces are a suite of models of human colour vision and perception. <code>pavo 1.0</code> now includes two of the most commonly used: the foundational 1931 CIE XYZ space, and the more modern, perceptually calibrated CIE LAB space and its cylindrical CIE LCh transformation. Tristimulus values in XYZ space are calculated as:</p>
<p><span class="math display">\[X = k\int_{300}^{700}{R(\lambda)I(\lambda)\bar{x}(\lambda)\,d\lambda}\]</span> <span class="math display">\[Y = k\int_{300}^{700}{R(\lambda)I(\lambda)\bar{y}(\lambda)\,d\lambda}\]</span> <span class="math display">\[Z = k\int_{300}^{700}{R(\lambda)I(\lambda)\bar{z}(\lambda)\,d\lambda}\]</span></p>
<p>where <em>x</em>, <em>y</em>, and <em>z</em> are the trichromatic colour matching functions for a ‘standard colourimetric viewer’. These functions are designed to describe an average human’s chromatic response within a specified viewing arc in the fovea (to account for the uneven distribution of cones across eye). <code>pavo</code> includes both the CIE 2-degree and the modern 10-degree standard observer, which can be selected in the <code>visual</code> option in the <code>vismodel</code> function. In these equations, k is the normalising factor</p>
<p><span class="math display">\[k = \frac{100}{\int_{300}^{700}{I(\lambda)\bar{y}(\lambda)\,d\lambda}}\]</span></p>
<p>and the chromaticity coordinates of stimuli are calculated as</p>
<p><span class="math display">\[x = \frac{X}{X + Y + Z}\]</span> <span class="math display">\[y = \frac{Y}{X + Y + Z}\]</span> <span class="math display">\[z = \frac{Z}{X + Y + Z} = 1 - x - y\]</span></p>
<p>For modelling in both XYZ and LAB spaces, here we’ll use the CIE 10-degree standard observer, and assume a <code>D65</code> ‘standard daylight’ illuminant. Again, although they are colourspace models, we need to set <code>relative = FALSE</code> to return raw quantum catch estimates, <code>vonkries = TRUE</code> to account for the required normalising factor (as above), and <code>achromatic = 'none'</code> since there is no applicable way to estimate luminance in the CIE models. As with all models that have particular requirements, <code><a href="../reference/vismodel.html">vismodel()</a></code> will output warnings and/or errors if unusual or non-standard arguments are specified.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> <span class="st">'cie10'</span>, <span class="dt">illum =</span> <span class="st">'D65'</span>, <span class="dt">vonkries =</span> <span class="ot">TRUE</span>, <span class="dt">relative =</span> <span class="ot">FALSE</span>, <span class="dt">achromatic =</span> <span class="st">'none'</span>)</a></code></pre></div>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1">ciexyz.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">'ciexyz'</span>)</a>
<a class="sourceLine" id="cb80-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(ciexyz.flowers)</a></code></pre></div>
<pre><code>##                               X         Y         Z         x         y
## Goodenia_heterophylla 0.2074305 0.2067084 0.3013614 0.2899097 0.2889005
## Goodenia_geniculata   0.6472803 0.6752456 0.4240380 0.3706021 0.3866137
## Goodenia_gracilis     0.5153064 0.4587957 0.0153714 0.5207885 0.4636766
## Xyris_operculata      0.2884446 0.2353124 0.2224271 0.3865595 0.3153544
## Eucalyptus_sp         0.4431842 0.4470468 0.4019893 0.3429634 0.3459524
## Faradaya_splendida    0.6636975 0.6553481 0.2869075 0.4132733 0.4080743
##                                z
## Goodenia_heterophylla 0.42118974
## Goodenia_geniculata   0.24278414
## Goodenia_gracilis     0.01553492
## Xyris_operculata      0.29808613
## Eucalyptus_sp         0.31108420
## Faradaya_splendida    0.17865248</code></pre>
<p>The output is simply the tristimulus values and chromaticity coordinates of stimuli, and we can visualise our results (along with a line connecting monochromatic loci, by default) by calling</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(ciexyz.flowers, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(flowers))</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-41-1.png" alt="Floral reflectance in the CIEXYZ human visual model. Note that this space is not perceptually calibrated, so we cannot make inferences about the similarity or differences of colours based on their relative location." width="480"><p class="caption">
Floral reflectance in the CIEXYZ human visual model. Note that this space is not perceptually calibrated, so we cannot make inferences about the similarity or differences of colours based on their relative location.
</p>
</div>
<p>The <code>Lab</code> space is a more recent development, and is a colour-opponent model that attempts to mimic the nonlinear responses of the human eye. The <code>Lab</code> space is also calibrated (unlike the <code>XYZ</code> space) such that Euclidean distances between points represent relative perceptual distances. This means that two stimuli that are farther apart in <code>Lab</code> space should be <em>perceived</em> as more different than two closer points. As the name suggests, the dimensions of the <code>Lab</code> space are <em>L</em>ightness (i.e. subjective brightness), along with two colour-opponent dimensions designated <em>a</em> and <em>b</em>. The <code><a href="../reference/colspace.html">colspace()</a></code> function, when <code>space = cielab</code>, simply converts points from the <code>XYZ</code> model according to:</p>
<p><span class="math display">\[
L=\begin{cases}
116\left(\frac{Y}{Y_n}\right)^\frac{1}{3} &amp; \text{if } \frac{Y}{Y_n} &gt; 0.008856 \\
903.3\left(\frac{Y}{Y_n}\right) &amp; \text{if } \frac{Y}{Y_n} \leq 0.008856
\end{cases}
\]</span></p>
<p><span class="math display">\[a = 500\left(f\left(\frac{X}{X_n}\right) - f\left(\frac{Y}{Y_n}\right)\right)\]</span></p>
<p><span class="math display">\[b = 500\left(f\left(\frac{Y}{Y_n}\right) - f\left(\frac{Z}{Z_n}\right)\right)\]</span></p>
<p>where</p>
<p><span class="math display">\[
f(x)=\begin{cases}
x^\frac{1}{3} &amp; \text{if } x &gt; 0.008856 \\
7.787x + \frac{4}{29} &amp; \text{if } x \leq 0.008856
\end{cases}
\]</span></p>
<p>Here, <span class="math inline">\(X_n, Y_n, Z_n\)</span> are neutral point values to model visual adaptation, calculated as:</p>
<p><span class="math display">\[X_n = \int_{300}^{700}{R_n(\lambda)I(\lambda)\bar{x}(\lambda)\,d\lambda}\]</span> <span class="math display">\[Y_n = \int_{300}^{700}{R_n(\lambda)I(\lambda)\bar{y}(\lambda)\,d\lambda}\]</span> <span class="math display">\[Z_n = \int_{300}^{700}{R_n(\lambda)I(\lambda)\bar{z}(\lambda)\,d\lambda}\]</span></p>
<p>when <span class="math inline">\(R_n(\lambda)\)</span> is a perfect diffuse reflector (i.e. 1).</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1">cielab.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">'cielab'</span>)</a>
<a class="sourceLine" id="cb83-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(cielab.flowers)</a></code></pre></div>
<pre><code>##                               X         Y         Z        L           a
## Goodenia_heterophylla 0.2074305 0.2067084 0.3013614 16.91253  0.91908831
## Goodenia_geniculata   0.6472803 0.6752456 0.4240380 55.24744 -7.78898966
## Goodenia_gracilis     0.5153064 0.4587957 0.0153714 37.53788 21.57990123
## Xyris_operculata      0.2884446 0.2353124 0.2224271 19.25286 19.66170677
## Eucalyptus_sp         0.4431842 0.4470468 0.4019893 36.57660  0.05744138
## Faradaya_splendida    0.6636975 0.6553481 0.2869075 53.61946  5.07048199
##                                b
## Goodenia_heterophylla -24.336189
## Goodenia_geniculata    19.981497
## Goodenia_gracilis      61.991586
## Xyris_operculata       -6.289287
## Eucalyptus_sp          -8.295538
## Faradaya_splendida     41.517115</code></pre>
<p>Our output now contains the tristimulus <code>XYZ</code> values, as well as their <code>Lab</code> counterparts, which are coordinates in the <code>Lab</code> space. These can also be visualised in three-dimensional <code>Lab</code> space by calling <code>plot</code>:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cielab.flowers, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(flowers))</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-43-1.png" alt="Floral reflectance spectra represented in the CIELab model of human colour sensation." width="480"><p class="caption">
Floral reflectance spectra represented in the CIELab model of human colour sensation.
</p>
</div>
</div>
<div id="categorical-fly-colourspace" class="section level4">
<h4 class="hasAnchor">
<a href="#categorical-fly-colourspace" class="anchor"></a>Categorical Fly Colourspace</h4>
<p>The categorical colour vision model of <span class="citation">Troje (1993)</span> is a model of dipteran vision, based on behavioural data from the blowfly <em>Lucilia</em> sp. It assumes the involvement of all four dipteran photoreceptor classes (R7 &amp; R8 ‘pale’ and ‘yellow’ subtypes), and further posits that colour vision is based on two specific opponent mechanisms (R7p - R8p, and R7y - R8y). The model assumes that all colours are perceptually grouped into one of four colour categories, and that flies are unable to distinguish between colours that fall within the same category.</p>
<p>We’ll use the visual systems of the muscoid fly <em>Musca domestica</em>, and will begin by estimating linear (i.e. untransformed) quantum catches for each of the four photoreceptors.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">qcatch =</span> <span class="st">'Qi'</span>, <span class="dt">visual =</span> <span class="st">'musca'</span>, <span class="dt">achromatic =</span> <span class="st">'none'</span>, <span class="dt">relative =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Our call to <code><a href="../reference/colspace.html">colspace()</a></code> will then simply estimate the location of stimuli in the categorical space as the difference in relative stimulation between ‘pale’ (R7p - R8p) and ‘yellow’ (R7y - R8y) photoreceptor pairs:</p>
<p><span class="math display">\[x = R7_p - R8_p\]</span></p>
<p><span class="math display">\[y = R7_y - R8_y\]</span></p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1">cat.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">'categorical'</span>)</a>
<a class="sourceLine" id="cb87-2" data-line-number="2"></a>
<a class="sourceLine" id="cb87-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(cat.flowers)</a></code></pre></div>
<pre><code>##                              R7p        R7y       R8p       R8y          x
## Goodenia_heterophylla 0.05387620 0.18710675 0.4335989 0.3254182 -0.3797227
## Goodenia_geniculata   0.02080100 0.08276037 0.3737596 0.5226791 -0.3529586
## Goodenia_gracilis     0.01153133 0.02501422 0.1420052 0.8214492 -0.1304739
## Xyris_operculata      0.01270355 0.12523436 0.4488383 0.4132238 -0.4361348
## Eucalyptus_sp         0.03461951 0.14207857 0.3977211 0.4255808 -0.3631016
## Faradaya_splendida    0.03599956 0.09188569 0.3129199 0.5591949 -0.2769203
##                                y category     r.vec lum
## Goodenia_heterophylla -0.1383114     p-y- 0.4041279  NA
## Goodenia_geniculata   -0.4399187     p-y- 0.5640108  NA
## Goodenia_gracilis     -0.7964350     p-y- 0.8070515  NA
## Xyris_operculata      -0.2879894     p-y- 0.5226389  NA
## Eucalyptus_sp         -0.2835023     p-y- 0.4606694  NA
## Faradaya_splendida    -0.4673092     p-y- 0.5431968  NA</code></pre>
<p>And it is simply the signs of these differences that define the four possible fly-colour categories (p+y+, p-y+, p+y-, p-y-), which we can see in the associated plot.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cat.flowers, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(flowers))</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-46-1.png" alt="Flowers in the categorical colourspace of Troje (1993)." width="480"><p class="caption">
Flowers in the categorical colourspace of Troje (1993).
</p>
</div>
</div>
<div id="segment-classification" class="section level4">
<h4 class="hasAnchor">
<a href="#segment-classification" class="anchor"></a>Segment Classification</h4>
<p>The segment classification analysis <span class="citation">(Endler 1990)</span> does not assume any particular visual system, but instead tries to classify colours in a manner that captures common properties of many vertebrate (and some invertebrate) visual systems. In essence, it breaks down the reflectance spectrum region of interest into four equally-spaced regions, measuring the relative signal along those regions. This approximates a tetrachromatic system with ultraviolet, short, medium, and long-wavelength sensitive photoreceptors.</p>
<p>Though somewhat simplistic, this model captures many of the properties of other, more complex visual models, but without many of the additional assumptions these make. It also provides results in a fairly intuitive colour space, in which the angle corresponds to hue and the distance from the centre corresponds to chroma (Figure below; in fact, variables <code>S5</code> and <code>H4</code> from <code><a href="../reference/summary.rspec.html">summary.rspec()</a></code> are calculated from these relative segments). Note that, while a segment analysis ranging from 300 or 400 nm to 700 nm corresponds quite closely to the human visual system colour wheel, any wavelength range can be analysed in this way, returning a 360° hue space delimited by the range used.</p>
<p>The segment differences or “opponents” are calculated as:</p>
<p><span class="math display">\[LM = \frac{ R_\lambda \sum_{\lambda={Q4}} R_\lambda - \sum_{\lambda={Q2}} R_\lambda }{\sum_{\lambda={min}}^{max}R_\lambda}\]</span> <span class="math display">\[MS = \frac{ R_\lambda \sum_{\lambda={Q3}} R_\lambda - \sum_{\lambda={Q1}} R_\lambda }{\sum_{\lambda={min}}^{max}R_\lambda}\]</span></p>
<p>Where <span class="math inline">\(Qi\)</span> represent the interquantile distances (e.g. <span class="math inline">\(Q1=ultraviolet\)</span>, <span class="math inline">\(Q2=blue\)</span>, <span class="math inline">\(Q3=green\)</span> and <span class="math inline">\(Q4=red\)</span>)</p>
<p>The segment classification model is obtained through the <code><a href="../reference/colspace.html">colspace()</a></code> argument <code>space = 'segment'</code>, following initial modelling with <code><a href="../reference/vismodel.html">vismodel()</a></code>. The example below uses idealized reflectance spectra to illustrate how the avian colour space defined from the segment classification maps to the human colour wheel:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1">fakedata1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span>(</a>
<a class="sourceLine" id="cb90-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">100</span>, <span class="dv">500</span>, <span class="dt">by =</span> <span class="dv">20</span>),</a>
<a class="sourceLine" id="cb90-3" data-line-number="3">  <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(</a>
<a class="sourceLine" id="cb90-4" data-line-number="4">      <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, x, <span class="dv">30</span>),</a>
<a class="sourceLine" id="cb90-5" data-line-number="5">      <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, x <span class="op">+</span><span class="st"> </span><span class="dv">400</span>, <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb90-6" data-line-number="6">    )), <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>(<span class="dv">401</span>)</a>
<a class="sourceLine" id="cb90-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb90-8" data-line-number="8"></a>
<a class="sourceLine" id="cb90-9" data-line-number="9"><span class="co"># creating idealized specs with varying saturation</span></a>
<a class="sourceLine" id="cb90-10" data-line-number="10">fakedata2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span>(</a>
<a class="sourceLine" id="cb90-11" data-line-number="11">  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">500</span>, <span class="dv">300</span>, <span class="dv">150</span>, <span class="dv">105</span>, <span class="dv">75</span>, <span class="dv">55</span>, <span class="dv">40</span>, <span class="dv">30</span>),</a>
<a class="sourceLine" id="cb90-12" data-line-number="12">  <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, <span class="dv">550</span>, x),</a>
<a class="sourceLine" id="cb90-13" data-line-number="13">  <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span>(<span class="dv">401</span>)</a>
<a class="sourceLine" id="cb90-14" data-line-number="14">)</a>
<a class="sourceLine" id="cb90-15" data-line-number="15"></a>
<a class="sourceLine" id="cb90-16" data-line-number="16">fakedata1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">wl =</span> <span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, fakedata1))</a></code></pre></div>
<pre><code>## wavelengths found in column 1</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1">fakedata1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(fakedata1, <span class="st">"max"</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## Scaling spectra to a maximum value of 1</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1">fakedata2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">wl =</span> <span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, fakedata2))</a></code></pre></div>
<pre><code>## wavelengths found in column 1</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1">fakedata2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(fakedata2, <span class="st">"sum"</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## Scaling spectra to a total area of 1</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1">fakedata2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/procspec.html">procspec</a></span>(fakedata2, <span class="st">"min"</span>)</a></code></pre></div>
<pre><code>## processing options applied:
## Scaling spectra to a minimum value of zero</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="co"># converting reflectance to percentage</span></a>
<a class="sourceLine" id="cb100-2" data-line-number="2">fakedata1[, <span class="dv">-1</span>] &lt;-<span class="st"> </span>fakedata1[, <span class="dv">-1</span>] <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb100-3" data-line-number="3">fakedata2[, <span class="dv">-1</span>] &lt;-<span class="st"> </span>fakedata2[, <span class="dv">-1</span>] <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(fakedata2[, <span class="dv">-1</span>]) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb100-4" data-line-number="4"></a>
<a class="sourceLine" id="cb100-5" data-line-number="5"><span class="co"># combining and converting to rspec</span></a>
<a class="sourceLine" id="cb100-6" data-line-number="6">fakedata.c &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">wl =</span> <span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, fakedata1[, <span class="dv">-1</span>], fakedata2[, <span class="dv">-1</span>])</a>
<a class="sourceLine" id="cb100-7" data-line-number="7">fakedata.c &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(fakedata.c)</a></code></pre></div>
<pre><code>## wavelengths found in column 1</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="co"># segment classification analysis</span></a>
<a class="sourceLine" id="cb102-2" data-line-number="2">seg.vis &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(fakedata.c, <span class="dt">visual =</span> <span class="st">"segment"</span>, <span class="dt">achromatic =</span> <span class="st">"all"</span>)</a></code></pre></div>
<pre><code>## Warning: segment analysis chosen, overriding incompatible parameters.</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1">seg.fdc &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(seg.vis, <span class="dt">space =</span> <span class="st">"segment"</span>)</a>
<a class="sourceLine" id="cb104-2" data-line-number="2"></a>
<a class="sourceLine" id="cb104-3" data-line-number="3"><span class="co"># plot results</span></a>
<a class="sourceLine" id="cb104-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(seg.fdc, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(fakedata.c))</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-47-1.png" alt="Idealized reflectance spectra and their projection on the axes of segment classification" width="384"><p class="caption">
Idealized reflectance spectra and their projection on the axes of segment classification
</p>
</div>
</div>
<div id="colourspace-distances-with-coldist" class="section level4">
<h4 class="hasAnchor">
<a href="#colourspace-distances-with-coldist" class="anchor"></a>Colourspace Distances with <code>coldist</code>
</h4>
<p>Under the colour space framework, colour distances can be calculated simply as Euclidean distances of the relative cone stimulation data, either log-transformed or not, depending on how it was defined. However, these distances cannot be interpreted in terms of JNDs, since no receptor noise is incorporated in the model. Euclidean distances can be computed in <code>R</code> using the <code><a href="../reference/coldist.html">coldist()</a></code> function on the <code><a href="../reference/colspace.html">colspace()</a></code> output:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw"><a href="../reference/coldist.html">coldist</a></span>(tetra.flowers))</a></code></pre></div>
<pre><code>## Warning: Quantum catch are relative, distances may not be meaningful</code></pre>
<pre><code>## Calculating unweighted Euclidean distances</code></pre>
<pre><code>##                  patch1              patch2         dS dL
## 1 Goodenia_heterophylla Goodenia_geniculata 0.06695922 NA
## 2 Goodenia_heterophylla   Goodenia_gracilis 0.20467411 NA
## 3 Goodenia_heterophylla    Xyris_operculata 0.05407934 NA
## 4 Goodenia_heterophylla       Eucalyptus_sp 0.01901724 NA
## 5 Goodenia_heterophylla  Faradaya_splendida 0.05027645 NA
## 6 Goodenia_heterophylla  Gaultheria_hispida 0.03897671 NA</code></pre>
<p>Specialised colourspace models such as the colour-hexagon, coc space, CIELab and CIELCh models have their own distance measures, which are returned be default when run through <code><a href="../reference/coldist.html">coldist()</a></code>. Be sure to read the <code><a href="../reference/coldist.html">?coldist</a></code> documentation, and the original publications, to understand what is being returned. As an example, if we run the results of colour-hexagon modelling through <code><a href="../reference/coldist.html">coldist()</a></code>:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="co"># Model flower colours according to a honeybee</span></a>
<a class="sourceLine" id="cb109-2" data-line-number="2">vis.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> <span class="st">"apis"</span>, <span class="dt">qcatch =</span> <span class="st">"Ei"</span>, <span class="dt">relative =</span> <span class="ot">FALSE</span>, <span class="dt">vonkries =</span> <span class="ot">TRUE</span>, <span class="dt">achromatic =</span> <span class="st">"l"</span>, <span class="dt">bkg =</span> <span class="st">"green"</span>)</a>
<a class="sourceLine" id="cb109-3" data-line-number="3">hex.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/colspace.html">colspace</a></span>(vis.flowers, <span class="dt">space =</span> <span class="st">"hexagon"</span>)</a>
<a class="sourceLine" id="cb109-4" data-line-number="4"></a>
<a class="sourceLine" id="cb109-5" data-line-number="5"><span class="co"># Estimate colour distances. No need to specify relative receptor densities, noise etc.,</span></a>
<a class="sourceLine" id="cb109-6" data-line-number="6"><span class="co"># which only apply in the case of receptor-noise modelling</span></a>
<a class="sourceLine" id="cb109-7" data-line-number="7">dist.flowers &lt;-<span class="st"> </span><span class="kw"><a href="../reference/coldist.html">coldist</a></span>(hex.flowers)</a></code></pre></div>
<pre><code>## Calculating unweighted Euclidean distances</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(dist.flowers)</a></code></pre></div>
<pre><code>##                  patch1              patch2        dS dL
## 1 Goodenia_heterophylla Goodenia_geniculata 0.3207265 NA
## 2 Goodenia_heterophylla   Goodenia_gracilis 0.6870945 NA
## 3 Goodenia_heterophylla    Xyris_operculata 0.3025298 NA
## 4 Goodenia_heterophylla       Eucalyptus_sp 0.1111375 NA
## 5 Goodenia_heterophylla  Faradaya_splendida 0.2324927 NA
## 6 Goodenia_heterophylla  Gaultheria_hispida 0.2280836 NA</code></pre>
<p>the chromatic contrasts <code>dS</code> and achromatic contrasts <code>dL</code> are expressed as Euclidean distances in the hexagon, known as ‘hexagon units’ <span class="citation">(Chittka 1992)</span>. If we had instead used the colour-opponent coding space the units would have been city-bloc distances, while in the CIELab model the distances would be derived from the CIE colour-distance formula (2000).</p>
</div>
<div id="distances-in-n-dimensions" class="section level4">
<h4 class="hasAnchor">
<a href="#distances-in-n-dimensions" class="anchor"></a>Distances in N-Dimensions</h4>
<p>The <code><a href="../reference/coldist.html">coldist()</a></code> function is no longer limited to di-, tri- or tetrachromatic visual systems. The function has been generalised, and can now calculate colour distances for n-dimensional visual phenotypes. This means there is no limit on the dimensionality of visual systems that may be input, which may prove useful for modelling nature’s extremes (e.g. butterflies, mantis shrimp) or for simulation-based work. Naturally, since these calculations aren’t largely implemented elsewhere, we recommend caution and validation of results prior to publication.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1"><span class="co"># Create an arbitrary visual phenotype with 10 photoreceptors</span></a>
<a class="sourceLine" id="cb113-2" data-line-number="2">fakemantisshrimp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/sensmodel.html">sensmodel</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">325</span>, <span class="dv">350</span>, <span class="dv">400</span>, <span class="dv">425</span>, <span class="dv">450</span>, <span class="dv">500</span>, <span class="dv">550</span>, <span class="dv">600</span>, <span class="dv">650</span>, <span class="dv">700</span>), <span class="dt">beta =</span> <span class="ot">FALSE</span>, <span class="dt">integrate =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb113-3" data-line-number="3"></a>
<a class="sourceLine" id="cb113-4" data-line-number="4"><span class="co"># Convert to percentages, just to colour the plot</span></a>
<a class="sourceLine" id="cb113-5" data-line-number="5">fakemantisshrimp.colours &lt;-<span class="st"> </span>fakemantisshrimp <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb113-6" data-line-number="6">fakemantisshrimp.colours[, <span class="st">"wl"</span>] &lt;-<span class="st"> </span>fakemantisshrimp[, <span class="st">"wl"</span>]</a>
<a class="sourceLine" id="cb113-7" data-line-number="7"></a>
<a class="sourceLine" id="cb113-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(fakemantisshrimp, <span class="dt">col =</span> <span class="kw"><a href="../reference/spec2rgb.html">spec2rgb</a></span>(fakemantisshrimp.colours), <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">ylab =</span> <span class="st">"Absorbance"</span>)</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-50-1.png" alt="Visual system of a pretend mantis shrimp with 10 cones" width="384"><p class="caption">
Visual system of a pretend mantis shrimp with 10 cones
</p>
</div>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1"><span class="co"># Run visual model and calculate colour distances</span></a>
<a class="sourceLine" id="cb114-2" data-line-number="2">vm.fms &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(flowers, <span class="dt">visual =</span> fakemantisshrimp, <span class="dt">relative =</span> <span class="ot">FALSE</span>, <span class="dt">achromatic =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb114-3" data-line-number="3"></a>
<a class="sourceLine" id="cb114-4" data-line-number="4">JND.fms &lt;-<span class="st"> </span><span class="kw"><a href="../reference/coldist.html">coldist</a></span>(vm.fms, <span class="dt">n =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">5</span>))</a></code></pre></div>
<pre><code>## Calculating noise-weighted Euclidean distances</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(JND.fms)</a></code></pre></div>
<pre><code>##                  patch1              patch2        dS dL
## 1 Goodenia_heterophylla Goodenia_geniculata 16.297557 NA
## 2 Goodenia_heterophylla   Goodenia_gracilis 48.390309 NA
## 3 Goodenia_heterophylla    Xyris_operculata 30.760482 NA
## 4 Goodenia_heterophylla       Eucalyptus_sp  6.044184 NA
## 5 Goodenia_heterophylla  Faradaya_splendida 15.901435 NA
## 6 Goodenia_heterophylla  Gaultheria_hispida 11.188246 NA</code></pre>
</div>
</div>
</div>
</div>
<div id="analyzing-spatial-data" class="section level1">
<h1 class="hasAnchor">
<a href="#analyzing-spatial-data" class="anchor"></a>Analyzing Spatial Data</h1>
<p><code>pavo</code> now allows for the combined analysis of spectral data and spatial data. Note that ‘spatial’ data of course include images, but may also draw on spatially-sampled <em>spectra</em>, as explored below. Thus while much of the below deals with image-based processing and analysis, images are not necessary for many spatial analyses and indeed may perform worse than spectrally-based analyses in some cases. Further, <strong>image data should seldom be used without input from spectral measurements</strong>. Even in the simple butterfly example below, users should first validate the presence and number of discrete colours in a patch via spectral measurement and visual modelling (i.e. the ‘spectral’ information), which is then augmented by image-based clustering of these <em>a priori</em> identified patches to extract the ‘spatial’ information. Using uncalibrated images alone for inferences about colour pattern perception may well yield unreliable results, given the radical differences between human (camera) and non-human animal perception.</p>
<div id="image-based-colour-classification" class="section level2">
<h2 class="hasAnchor">
<a href="#image-based-colour-classification" class="anchor"></a>Image-based colour classification</h2>
<p>We first import our images with <code><a href="../reference/getimg.html">getimg()</a></code>, which functions in a similar manner to <code><a href="../reference/getspec.html">getspec()</a></code>. Since we are importing more than one image, we can simply point the funtion to the folder containing the images, and it will use parallel processing (where possible) to import any jpg, bmp, or png images in the folder. As with the raw spectra, these images are also available at the package repository [here][data-location], but are included in the package installation for convenience.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1">butterflies &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getimg.html">getimg</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"testdata/images/"</span>, <span class="dt">package =</span> <span class="st">'pavo'</span>))</a></code></pre></div>
<pre><code>## 2 files found; importing images.</code></pre>
<p>The segmentation of RGB images into discrete colour-classes is an useful step on the road to several analyses, and this is carried out in <code>pavo</code> via <code><a href="../reference/classify.html">classify()</a></code>. The function currently implements k-means clustering which, and offers some flexibility in the way in which it is carried out. In the simplest case, we can specify an image or image(s) as well as the number of discrete colours in each, and allow the k-means clustering algorithm to do its work. <strong>Note that the specification of <em>k</em>, the number of discrete colours in an image, is a crucial step to be estimated <em>a priori</em> beforehand</strong>, typically through the use of visual modelling to estimate the number of discriminable colours in an ‘objective’ manner. There are a suite of possible ways in which this may be achieved, though, with one detailed below as part of example 2.</p>
<p>Since we have two images, with (arguably) four and three colours each, including the white background, we can specify this information using <code>kcols</code>, before visualising the results with <code>summary</code>. The <code>summary</code> function, with <code>plot = TRUE</code>, is also particularly useful for understanding the colour-class labels, or ID’s, assigned to each colour, as well as visualising the accuracy of the classification process, which may be enhanced by specifying strongly-contrasting ‘false’ colours for plotting through the <code>col</code> argument.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1">butterflies_class &lt;-<span class="st"> </span><span class="kw"><a href="../reference/classify.html">classify</a></span>(butterflies, <span class="dt">kcols =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">4</span>, <span class="dv">3</span>))</a></code></pre></div>
<pre><code>## Image classification in progress...</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1"><span class="co"># Note that we could simply feed the list of images to summary, rather than</span></a>
<a class="sourceLine" id="cb122-2" data-line-number="2"><span class="co"># specifying individual images, and they would progress automatically</span></a>
<a class="sourceLine" id="cb122-3" data-line-number="3"><span class="co"># with user input.</span></a>
<a class="sourceLine" id="cb122-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(butterflies_class[[<span class="dv">2</span>]], <span class="dt">plot =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-53-1.png" alt="The k-means classified images of our butterflies, along with their identified colour palettes" width="480"><p class="caption">
The k-means classified images of our butterflies, along with their identified colour palettes
</p>
</div>
<p>There are other options available, which may be of particular use when the classification process is not producing the results that might be expected. If analysing similar images with homologous colour patterns (e.g. individuals within a species), we could specify a single ‘reference’ image in a list to be initially classified, using <code>refID</code>, with the RGB centres identified in this reference image used as pre-specified cluster centres in subsequent images. This helps to ensure that homologous pattern elements are reliably identified and classified between images. The <code><a href="../reference/classify.html">classify()</a></code> function also offers an interactive option, via <code>interactive = TRUE</code>, wherein we can interactively click on representative colours within an image (or images individually), with the RGB values then used as cluster centres. This is particularly useful when images are being erroneously classified, since the standard k-means process randomly selects initial centres and so may (by chance) miss smaller patches, or confuse similar colours. By specifying the initial RGB centres interactively, it can be easier for the process to distinguish or ‘pull apart’ colours in such circumstances. Ultimately, there are several combinations of options available during classification, which are also documented in the help file. For our butterflies, for example, we could use any of the following (though some would be very ill-advised):</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="co"># Automatic classification.</span></a>
<a class="sourceLine" id="cb123-2" data-line-number="2">butterflies_class &lt;-<span class="st"> </span><span class="kw"><a href="../reference/classify.html">classify</a></span>(butterflies, <span class="dt">kcols =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">4</span>, <span class="dv">3</span>))</a></code></pre></div>
<pre><code>## Image classification in progress...</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1"><span class="co"># Automatic classification using a reference image, identified by name.</span></a>
<a class="sourceLine" id="cb125-2" data-line-number="2">butterflies_class &lt;-<span class="st"> </span><span class="kw"><a href="../reference/classify.html">classify</a></span>(butterflies, <span class="dt">refID =</span> <span class="st">'h_melpomene'</span>, <span class="dt">kcols =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## Image classification in progress...</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1"><span class="co"># Classification using interactively-specified centres for each image, with no</span></a>
<a class="sourceLine" id="cb127-2" data-line-number="2"><span class="co"># need to specify kcols (since it will be inferred from the numbers of colours selected)</span></a>
<a class="sourceLine" id="cb127-3" data-line-number="3">butterflies_class &lt;-<span class="st"> </span><span class="kw"><a href="../reference/classify.html">classify</a></span>(butterflies, <span class="dt">interactive =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb127-4" data-line-number="4"></a>
<a class="sourceLine" id="cb127-5" data-line-number="5"><span class="co"># Classification using interactively-specified centres for the single reference image</span></a>
<a class="sourceLine" id="cb127-6" data-line-number="6"><span class="co"># (here, the first in the list). We could also specify reference image using it's name, </span></a>
<a class="sourceLine" id="cb127-7" data-line-number="7"><span class="co"># as above.</span></a>
<a class="sourceLine" id="cb127-8" data-line-number="8">butterflies_class &lt;-<span class="st"> </span><span class="kw"><a href="../reference/classify.html">classify</a></span>(butterflies, <span class="dt">refID =</span> <span class="dv">1</span>, <span class="dt">interactive =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="adjacency-and-boundary-strength-analyses-and-overall-pattern-contrasts" class="section level2">
<h2 class="hasAnchor">
<a href="#adjacency-and-boundary-strength-analyses-and-overall-pattern-contrasts" class="anchor"></a>Adjacency and Boundary Strength Analyses, and Overall Pattern Contrasts</h2>
<p>The adjacency <span class="citation">(Endler 2012)</span> and boundary strength <span class="citation">(Endler, Cole, and Kranz 2018)</span> analyses offer a powerful method for quantifying various features of colour pattern geometry. Briefly, the process entails classifying grid-sampled locations within a visual scene into a number of discrete colour classes. This may be achieved using <code><a href="../reference/classify.html">classify()</a></code> as described above before sampling the now-classified image, and/or by taking grid-sampled reflectance spectra across a visual scene, visually modelling and clustering the results <span class="citation">(as per “method 1” in Endler 2012, example below)</span>. The column-wise and row-wise colour-class transitions between adjacent points within this grid are then tallied, and from this a suite of summary statistics on pattern structure — from simple colour proportions, through to colour diversity and pattern complexity — are estimated. If the colour ‘distance’ between adjacent colour classes is known, such as might be estimated using spectral data for receptor-noise modelling via <code><a href="../reference/vismodel.html">vismodel()</a></code> and <code><a href="../reference/coldist.html">coldist()</a></code>, then this can also be incorporated to derive several measures of the salience of patch boundaries <span class="citation">(Endler, Cole, and Kranz 2018)</span>. Finally, if estimates of hue, saturation, and/or brightness are known for each discrete colour in a pattern, then these can be included through the <code>hsl</code> argument for general, area-weighted measures of overall pattern contrast <span class="citation">(Endler and Mielke 2005)</span>. In <code>pavo</code>, this is all carried out through the <code><a href="../reference/adjacent.html">adjacent()</a></code> function, which takes several arguments that should be well understood.</p>
<div id="example-1-simple-mounted-butterflies" class="section level3">
<h3 class="hasAnchor">
<a href="#example-1-simple-mounted-butterflies" class="anchor"></a>Example 1 (simple): mounted butterflies</h3>
<p>We’ll begin with a simple example using mounted butterflies, by first loading and classifying our images in the manner outlined above. For the adjacency analysis proper, we’ll specify a full x-dimension scale of 200 mm using <code>xscale</code> (which could be ignored if we specify scales using <code><a href="../reference/procimg.html">procimg()</a></code>), and a sampling density of 200, for a 200 x 200 grid. Since the white background of our images is fake and of no interest, we will also exclude it by specifying the colour-class ID that corresponds to it (for more complex backgrounds, we could instead use <code><a href="../reference/procimg.html">procimg()</a></code>, as above, and ignore this argument).</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1"><span class="co"># Load up our images</span></a>
<a class="sourceLine" id="cb128-2" data-line-number="2">butterflies &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getimg.html">getimg</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"testdata/images/"</span>, <span class="dt">package =</span> <span class="st">'pavo'</span>))</a></code></pre></div>
<pre><code>## 2 files found; importing images.</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" data-line-number="1"><span class="co"># Automatically classify discrete colour patches (as confirmed by spectral modelling)</span></a>
<a class="sourceLine" id="cb130-2" data-line-number="2"><span class="co"># using k-means clustering, with values of 'k' that have been validated a priori.</span></a>
<a class="sourceLine" id="cb130-3" data-line-number="3">butterflies_class &lt;-<span class="st"> </span><span class="kw"><a href="../reference/classify.html">classify</a></span>(butterflies, <span class="dt">kcols =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">4</span>, <span class="dv">3</span>))</a></code></pre></div>
<pre><code>## Image classification in progress...</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1"><span class="co"># Run the adjacency analysis, subsampling the image in a 200x200 grid, and excluding</span></a>
<a class="sourceLine" id="cb132-2" data-line-number="2"><span class="co"># the white background.</span></a>
<a class="sourceLine" id="cb132-3" data-line-number="3">butterflies_adj &lt;-<span class="st"> </span><span class="kw"><a href="../reference/adjacent.html">adjacent</a></span>(butterflies_class, <span class="dt">xscale =</span> <span class="dv">200</span>, <span class="dt">xpts =</span> <span class="dv">200</span>, <span class="dt">bkgID =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb132-4" data-line-number="4"></a>
<a class="sourceLine" id="cb132-5" data-line-number="5"><span class="co"># Take a look</span></a>
<a class="sourceLine" id="cb132-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(butterflies_adj)</a></code></pre></div>
<pre><code>##             k     N n_off        p_1       p_2       p_3       p_4
## h_melpomene 4 54064  5111 0.03511029 0.0406250 0.5833824 0.3408824
## papilio     3 63241  4387 0.23905660 0.5607233 0.2002201        NA
##                   q_1_1       q_1_2      q_2_2      q_1_3     q_3_3
## h_melpomene 0.006510802 0.009821693 0.02683856 0.01294762 0.5649970
## papilio     0.209183915 0.012839772 0.54839424 0.04936671 0.1730523
##                  q_1_4      q_2_4      q_3_4     q_4_4     t_1_2     t_1_3
## h_melpomene 0.03486608 0.01825614 0.01864457 0.3071175 0.1038936 0.1369595
## papilio             NA         NA         NA        NA 0.1850923 0.7116481
##                 t_1_4     t_2_4     t_3_4       q_2_3     t_2_3          m
## h_melpomene 0.3688124 0.1931129 0.1972217          NA        NA 0.09395221
## papilio            NA        NA        NA 0.007163075 0.1032596 0.06894056
##                    m_r        m_c         A       Sc       St        Jc
## h_melpomene 0.08779412 0.10011029 0.8769739 2.176663 4.136277 0.5441657
## papilio     0.07836478 0.05951633 1.3166937 2.429267 1.813682 0.8097558
##                    Jt         B        Rt Rab m_dS s_dS cv_dS m_dL s_dL
## h_melpomene 0.6893795 0.4558795 0.4803734   1   NA   NA    NA   NA   NA
## papilio     0.6045606 0.1253704 0.5513647   1   NA   NA    NA   NA   NA
##             cv_dL m_hue s_hue var_hue m_sat s_sat cv_sat m_lum s_lum
## h_melpomene    NA    NA    NA      NA    NA    NA     NA    NA    NA
## papilio        NA    NA    NA      NA    NA    NA     NA    NA    NA
##             cv_lum
## h_melpomene     NA
## papilio         NA</code></pre>
<p>The output is a suite of statistics describing colour pattern structure and geometry in a tidy data frame that, since we fed it a list of images, contains one row for each of our samples. As always, the function’s help file (<code><a href="../reference/adjacent.html">?adjacent</a></code>) summarises the meaning of each output variable, and the original references listed therein contain the full discussion. Note that some of the output is <code>NA</code>, which might occur when the focal statistic simply makes no sense for the image in question (such as the transition frequency between colour categories 3 and 4, for an image that contains only 3 colour categories). Others may result when we do not give <code><a href="../reference/adjacent.html">adjacent()</a></code> enough information, such as the colour-distances required to calculate the boundary-strength statistics, or the colourmetrics required for overall pattern contrast. If we do give the function this information, we can see that those final variables now contain sensible output.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1"><span class="co"># Create a fake matrix of pairwise colour- and luminance distances between all</span></a>
<a class="sourceLine" id="cb134-2" data-line-number="2"><span class="co"># colour patten elements, as might be attained through visual modelling of spectral data.</span></a>
<a class="sourceLine" id="cb134-3" data-line-number="3">distances &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">c1 =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb134-4" data-line-number="4">                        <span class="dt">c2 =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb134-5" data-line-number="5">                        <span class="dt">dS =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10.6</span>, <span class="fl">5.1</span>, <span class="fl">4.4</span>),</a>
<a class="sourceLine" id="cb134-6" data-line-number="6">                        <span class="dt">dL =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.1</span>, <span class="fl">2.5</span>, <span class="fl">3.2</span>))</a>
<a class="sourceLine" id="cb134-7" data-line-number="7"></a>
<a class="sourceLine" id="cb134-8" data-line-number="8"><span class="co"># Take a look</span></a>
<a class="sourceLine" id="cb134-9" data-line-number="9">distances</a></code></pre></div>
<pre><code>##   c1 c2   dS  dL
## 1  1  2 10.6 1.1
## 2  1  3  5.1 2.5
## 3  2  3  4.4 3.2</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1"><span class="co"># And our fake hue angles (in radians), saturation, and luminance values, for each</span></a>
<a class="sourceLine" id="cb136-2" data-line-number="2"><span class="co"># colour pattern element</span></a>
<a class="sourceLine" id="cb136-3" data-line-number="3">hsl_vals &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">patch =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb136-4" data-line-number="4">                       <span class="dt">hue =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.2</span>, <span class="fl">2.2</span>, <span class="fl">1.6</span>),</a>
<a class="sourceLine" id="cb136-5" data-line-number="5">                       <span class="dt">lum =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">7</span>),</a>
<a class="sourceLine" id="cb136-6" data-line-number="6">                       <span class="dt">sat =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">3.5</span>, <span class="fl">1.1</span>, <span class="fl">6.3</span>))</a>
<a class="sourceLine" id="cb136-7" data-line-number="7"></a>
<a class="sourceLine" id="cb136-8" data-line-number="8"><span class="co"># Take a look</span></a>
<a class="sourceLine" id="cb136-9" data-line-number="9">hsl_vals</a></code></pre></div>
<pre><code>##   patch hue lum sat
## 1     1 1.2  10 3.5
## 2     2 2.2   5 1.1
## 3     3 1.6   7 6.3</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" data-line-number="1"><span class="co"># Now feed this information into the adjacency analysis using the 'less-colourful'</span></a>
<a class="sourceLine" id="cb138-2" data-line-number="2"><span class="co"># of our two images, for convenience (though this could be readily extended to</span></a>
<a class="sourceLine" id="cb138-3" data-line-number="3"><span class="co"># include a list of images along with a list of distances and hsl values)</span></a>
<a class="sourceLine" id="cb138-4" data-line-number="4"><span class="kw"><a href="../reference/adjacent.html">adjacent</a></span>(butterflies_class[[<span class="dv">2</span>]], <span class="dt">xscale =</span> <span class="dv">200</span>, <span class="dt">xpts =</span> <span class="dv">200</span>, <span class="dt">bkgID =</span> <span class="dv">1</span>, <span class="dt">coldists =</span> distances, <span class="dt">hsl =</span> hsl_vals)</a></code></pre></div>
<pre><code>##         k     N n_off       p_1       p_2       p_3     q_1_1      q_1_2
## papilio 3 63241  4387 0.2390566 0.5607233 0.2002201 0.2091839 0.01283977
##             q_2_2      q_1_3       q_2_3     q_3_3     t_1_2     t_1_3
## papilio 0.5483942 0.04936671 0.007163075 0.1730523 0.1850923 0.7116481
##             t_2_3          m        m_r        m_c        A       Sc
## papilio 0.1032596 0.06894056 0.07836478 0.05951633 1.316694 2.429267
##               St        Jc        Jt         B        Rt Rab     m_dS
## papilio 1.813682 0.8097558 0.6045606 0.1253704 0.5513647   1 6.045726
##             s_dS     cv_dS     m_dL      s_dL     cv_dL    m_hue     s_hue
## papilio 3.255664 0.5385067 2.313152 0.9184739 0.3970658 1.663715 0.4154308
##           var_hue    m_sat    s_sat   cv_sat    m_lum   s_lum    cv_lum
## papilio 0.0826731 2.714881 2.666422 0.982151 6.595723 2.68164 0.4065726</code></pre>
</div>
<div id="example-2-complex-whole-visual-environments" class="section level3">
<h3 class="hasAnchor">
<a href="#example-2-complex-whole-visual-environments" class="anchor"></a>Example 2 (complex): whole visual environments</h3>
<p>Of course colour patterns are not always so simple, and we may want to analyse the spatial geometry of more complex or subtle scenes. In such cases, it may be preferable to largely forego image-based clustering and classification altogether and instead use spectral data directly in an adjacency-style analysis <span class="citation">(as per “method 1” in Endler 2012)</span>. One such approach would have us take spectral measurements across a patch in an evenly-spaced grid</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1"><span class="co"># Load up our image of a camouflaged lizard</span></a>
<a class="sourceLine" id="cb140-2" data-line-number="2">lizard &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getimg.html">getimg</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"testdata/images/vig/"</span>, <span class="dt">package =</span> <span class="st">'pavo'</span>))</a></code></pre></div>
<pre><code>## 1 files found; importing images.</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1"><span class="co"># Take a look at it</span></a>
<a class="sourceLine" id="cb142-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/graphics/par.html">par</a></span>(<span class="dt">mfrow =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb142-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(lizard)</a>
<a class="sourceLine" id="cb142-4" data-line-number="4"></a>
<a class="sourceLine" id="cb142-5" data-line-number="5"><span class="co"># And overlay a simple 'sampling grid' that might guide us as to where we should collect</span></a>
<a class="sourceLine" id="cb142-6" data-line-number="6"><span class="co"># our reflectance measurements. Note that the grid here is likely too coarse to capture the necessary detail,</span></a>
<a class="sourceLine" id="cb142-7" data-line-number="7"><span class="co"># though the sampling density is something to be closely considered on a case-by-case basis</span></a>
<a class="sourceLine" id="cb142-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(lizard)</a>
<a class="sourceLine" id="cb142-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(lizard)[<span class="dv">1</span>], <span class="dv">25</span>), <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>, <span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(lizard)[<span class="dv">1</span>], <span class="dv">25</span>)), <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">col =</span> <span class="st">'red'</span>)</a></code></pre></div>
<div class="figure">
<img src="pavo-3-analysing_files/figure-html/unnamed-chunk-58-1.png" alt="A cryptic lizard, along with a possible sampling grid for spectral measurement." width="480"><p class="caption">
A cryptic lizard, along with a possible sampling grid for spectral measurement.
</p>
</div>
<p>For the sake of this example we’ll simulate 100 reflectance spectra, as though we had collected them following the above grid. We’ll do this by creating four very similar groups of of 25 spectra, which will also allow us to get a sense of how our clustering methods perform. Of course real spectra will be more variable, but the same principles apply.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">12352</span>)  <span class="co"># For reprodicubility</span></a>
<a class="sourceLine" id="cb143-2" data-line-number="2"></a>
<a class="sourceLine" id="cb143-3" data-line-number="3"><span class="co"># Generate some fake spectra that were grid-sampled across our scene</span></a>
<a class="sourceLine" id="cb143-4" data-line-number="4">fakescene &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(</a>
<a class="sourceLine" id="cb143-5" data-line-number="5">  <span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(cbind, <span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">25</span>, <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, <span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="dv">1</span>, <span class="dv">320</span>, <span class="dv">330</span>), <span class="dv">20</span>))),</a>
<a class="sourceLine" id="cb143-6" data-line-number="6">  <span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(cbind, <span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">25</span>, <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, <span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="dv">1</span>, <span class="dv">440</span>, <span class="dv">450</span>), <span class="dv">20</span>))),</a>
<a class="sourceLine" id="cb143-7" data-line-number="7">  <span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(cbind, <span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">25</span>, <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, <span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="dv">1</span>, <span class="dv">550</span>, <span class="dv">560</span>), <span class="dv">20</span>))),</a>
<a class="sourceLine" id="cb143-8" data-line-number="8">  <span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(cbind, <span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">25</span>, <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span>(<span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, <span class="kw"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="dv">1</span>, <span class="dv">650</span>, <span class="dv">660</span>), <span class="dv">20</span>)))</a>
<a class="sourceLine" id="cb143-9" data-line-number="9">  )</a>
<a class="sourceLine" id="cb143-10" data-line-number="10"></a>
<a class="sourceLine" id="cb143-11" data-line-number="11"><span class="co"># Convert them to rspce objects</span></a>
<a class="sourceLine" id="cb143-12" data-line-number="12">fakescene &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.rspec.html">as.rspec</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">wl =</span> <span class="dv">300</span><span class="op">:</span><span class="dv">700</span>, fakescene))</a></code></pre></div>
<p>Now instead of calling <code>cluster()</code> on the image and arbitrarily selecting <code>kcols</code> (which would likely be quite inaccurate due to the complexity of the scene), we can visually model the spectra, calculate the colour-distances between them, and cluster the results into a data-image that can be fed directly into <code><a href="../reference/adjacent.html">adjacent()</a></code>. Below we’ll use a centroid-based ‘hartigan’ clustering method via the package <code>NbClust</code>, but there are numerous possible approaches that might be used, which should be closely considered with reference to the original methods’ publications.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1"><span class="co"># Visually model our spectra in a tetrahedral model of the blue tit, specifying</span></a>
<a class="sourceLine" id="cb144-2" data-line-number="2"><span class="co"># relative = FALSE so that we can estimate noise-calibrated distances.</span></a>
<a class="sourceLine" id="cb144-3" data-line-number="3">vis.fakescene &lt;-<span class="st"> </span><span class="kw"><a href="../reference/vismodel.html">vismodel</a></span>(fakescene, <span class="dt">visual =</span> <span class="st">'bluetit'</span>, <span class="dt">relative =</span> <span class="ot">FALSE</span>, <span class="dt">scale =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb144-4" data-line-number="4"></a>
<a class="sourceLine" id="cb144-5" data-line-number="5"><span class="co"># Calculate noise-weighted distances, before converting them to xyz coordinates</span></a>
<a class="sourceLine" id="cb144-6" data-line-number="6"><span class="co"># in noise-corrected colourspace.</span></a>
<a class="sourceLine" id="cb144-7" data-line-number="7">jnd.fakescene &lt;-<span class="st"> </span><span class="kw"><a href="../reference/jnd2xyz.html">jnd2xyz</a></span>(<span class="kw"><a href="../reference/coldist.html">coldist</a></span>(vis.fakescene))</a>
<a class="sourceLine" id="cb144-8" data-line-number="8"></a>
<a class="sourceLine" id="cb144-9" data-line-number="9"><span class="co"># Create a distance matrix, for clustering</span></a>
<a class="sourceLine" id="cb144-10" data-line-number="10">jnd.mat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/dist.html">dist</a></span>(jnd.fakescene, <span class="dt">method =</span> <span class="st">'euclidean'</span>, <span class="dt">diag =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb144-11" data-line-number="11"></a>
<a class="sourceLine" id="cb144-12" data-line-number="12"><span class="co"># Zero all distance &lt; 1 ('just noticeable distance', in this model), which corresponds</span></a>
<a class="sourceLine" id="cb144-13" data-line-number="13"><span class="co"># to a theoretical threshold of discrimination in the receptor-noise limited</span></a>
<a class="sourceLine" id="cb144-14" data-line-number="14"><span class="co"># model.</span></a>
<a class="sourceLine" id="cb144-15" data-line-number="15">jnd.mat[<span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(jnd.mat <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb144-16" data-line-number="16"></a>
<a class="sourceLine" id="cb144-17" data-line-number="17"><span class="co"># Load up a library and use k-means clustering to estimate the number of discrete</span></a>
<a class="sourceLine" id="cb144-18" data-line-number="18"><span class="co"># colours present in our sample.</span></a>
<a class="sourceLine" id="cb144-19" data-line-number="19"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(NbClust)</a>
<a class="sourceLine" id="cb144-20" data-line-number="20">clust &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/NbClust/man/NbClust.html">NbClust</a></span>(jnd.fakescene, <span class="dt">diss =</span> jnd.mat, <span class="dt">distance =</span> <span class="ot">NULL</span>, <span class="dt">method =</span> <span class="st">'centroid'</span>, <span class="dt">index =</span> <span class="st">'hartigan'</span>)</a></code></pre></div>
<pre><code>## Warning: partial match of 'value' to 'values'

## Warning: partial match of 'value' to 'values'</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1">clust<span class="op">$</span>Best.nc</a></code></pre></div>
<pre><code>## Number_clusters     Value_Index 
##           4.000        1639.353</code></pre>
<p>This approach has identified four distinct colour patches, as simulated. To be able to feed this information directly in to <code><a href="../reference/adjacent.html">adjacent()</a></code> we need to arrange the now-classified spectral data into a xyz data-image matrix, in which <code>x</code> and <code>y</code> coordinates specify the location of the sample in our scene, and the z values at each location specify the colour-class, or group, into which each sample has been classified (an integer). Many clustering packages offers the data’s classification as output in some form, so we can simply rearrange it into our original 10 x 10 sampling matrix before passing it to <code><a href="../reference/adjacent.html">adjacent()</a></code>.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1"><span class="co"># Rearrange the data into a colour-classified image matrix, and take a look at it.</span></a>
<a class="sourceLine" id="cb148-2" data-line-number="2"><span class="co"># Note that is the same structure as the output of 'classify()'.</span></a>
<a class="sourceLine" id="cb148-3" data-line-number="3">mat.fakescene &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(clust<span class="op">$</span>Best.partition)), <span class="dv">10</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb148-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(mat.fakescene)</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
## [1,]    1    1    1    2    2    3    3    3    4     4
## [2,]    1    1    1    2    2    3    3    3    4     4
## [3,]    1    1    1    2    2    3    3    3    4     4
## [4,]    1    1    1    2    2    3    3    3    4     4
## [5,]    1    1    1    2    2    3    3    3    4     4
## [6,]    1    1    2    2    2    3    3    4    4     4</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1"><span class="co"># Run the adjacency analysis</span></a>
<a class="sourceLine" id="cb150-2" data-line-number="2"><span class="kw"><a href="../reference/adjacent.html">adjacent</a></span>(mat.fakescene, <span class="dt">xscale =</span> <span class="dv">200</span>)</a></code></pre></div>
<pre><code>##     k   N n_off  p_1  p_2  p_3  p_4     q_1_1      q_1_2     q_2_2
## img 4 180    32 0.25 0.25 0.25 0.25 0.2055556 0.06111111 0.2055556
##          q_2_3     q_3_3      q_3_4     q_4_4   t_1_2  t_2_3   t_3_4     m
## img 0.05555556 0.2055556 0.06111111 0.2055556 0.34375 0.3125 0.34375 0.008
##       m_r   m_c  A Sc       St Jc        Jt  B Rt Rab m_dS s_dS cv_dS m_dL
## img 0.015 0.001 15  4 2.994152  1 0.4990253 NA NA  NA   NA   NA    NA   NA
##     s_dL cv_dL m_hue s_hue var_hue m_sat s_sat cv_sat m_lum s_lum cv_lum
## img   NA    NA    NA    NA      NA    NA    NA     NA    NA    NA     NA</code></pre>
<p>The output reflects several aspects of our simulated dataset, which is reassuring. There are four colour classes (<code>k</code>= 4) or equal proportion (<code>p_x</code>), 180 transitions in total (<code>N</code>, 9 transitions per row/column x 10 rows/columns), and the colour diversity (<code>Sc</code>) equals <code>k</code>, and relative colour diversity (<code>Jc</code>) equals 1, since all colours occur in equal proportions.</p>
</div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Andersson2006">
<p>Andersson, Staffan, and Maria Prager. 2006. “Quantification of Coloration.” In <em>Bird Coloration, Volume 1: Mechanisms and Measurements</em>, edited by Geoffrey E. Hill and Kevin J. McGraw, 1:640. Bird Coloration. Harvard University Press.</p>
</div>
<div id="ref-Backhaus1991">
<p>Backhaus, Werner. 1991. “Color Opponent Coding in the Visual System of the Honeybee.” <em>Vision Research</em> 31 (7): 1381–97. <a href="https://doi.org/10.1016/0042-6989(91)90059-E" class="uri">https://doi.org/10.1016/0042-6989(91)90059-E</a>.</p>
</div>
<div id="ref-Briscoe2001">
<p>Briscoe, Adriana D., and Lars Chittka. 2001. “The Evolution of Color Vision in Insects.” <em>Annual Review of Entomology</em> 46 (1): 471–510. <a href="https://doi.org/10.1146/annurev.ento.46.1.471" class="uri">https://doi.org/10.1146/annurev.ento.46.1.471</a>.</p>
</div>
<div id="ref-Chittka1992">
<p>Chittka, Lars. 1992. “The Colour Hexagon: A Chromaticity Diagram Based on Photoreceptor Excitations as a Generalized Representation of Colour Opponency.” <em>Journal of Comparative Physiology A</em> 170 (5): 533–43. <a href="https://doi.org/10.1007/BF00199331" class="uri">https://doi.org/10.1007/BF00199331</a>.</p>
</div>
<div id="ref-Endler1990">
<p>Endler, John A. 1990. “On the Measurement and Classification of Colour in Studies of Animal Colour Patterns.” <em>Biological Journal of the Linnean Society</em> 41 (4): 315–52. <a href="https://doi.org/10.1111/j.1095-8312.1990.tb00839.x" class="uri">https://doi.org/10.1111/j.1095-8312.1990.tb00839.x</a>.</p>
</div>
<div id="ref-Endler2012">
<p>———. 2012. “A Framework for Analysing Colour Pattern Geometry: Adjacent Colours.” <em>Biological Journal of the Linnean Society</em> 107 (2): 233–53. <a href="https://doi.org/10.1111/j.1095-8312.2012.01937.x" class="uri">https://doi.org/10.1111/j.1095-8312.2012.01937.x</a>.</p>
</div>
<div id="ref-Endler2018">
<p>Endler, John A., Gemma L. Cole, and Alexandrea M. Kranz. 2018. “Boundary Strength Analysis: Combining Colour Pattern Geometry and Coloured Patch Visual Properties for Use in Predicting Behaviour and Fitness.” Edited by Simon Blomberg. <em>Methods in Ecology and Evolution</em>, August. <a href="https://doi.org/10.1111/2041-210X.13073" class="uri">https://doi.org/10.1111/2041-210X.13073</a>.</p>
</div>
<div id="ref-Endler2005">
<p>Endler, John A., and Paul W. Mielke. 2005. “Comparing Entire Colour Patterns as Birds See Them.” <em>Biological Journal of the Linnean Society</em> 86 (4): 405–31. <a href="https://doi.org/10.1111/j.1095-8312.2005.00540.x" class="uri">https://doi.org/10.1111/j.1095-8312.2005.00540.x</a>.</p>
</div>
<div id="ref-Goldsmith1990">
<p>Goldsmith, Timothy H. 1990. “Optimization, Constraint, and History in the Evolution of Eyes.” <em>The Quarterly Review of Biology</em> 65 (3): 281–322. <a href="https://doi.org/10.1086/416840" class="uri">https://doi.org/10.1086/416840</a>.</p>
</div>
<div id="ref-Govardovskii2000">
<p>Govardovskii, Victor I., Nanna Fyhrquist, Tom Reuter, Dmitry G. Kuzmin, and Kristian Donner. 2000. “In Search of the Visual Pigment Template.” <em>Visual Neuroscience</em> 17 (4): 509–28. <a href="https://www.cambridge.org/core/journals/visual-neuroscience/article/in-search-of-the-visual-pigment-template/A4738E821720092B7F5A233C4AB4962B" class="uri">https://www.cambridge.org/core/journals/visual-neuroscience/article/in-search-of-the-visual-pigment-template/A4738E821720092B7F5A233C4AB4962B</a>.</p>
</div>
<div id="ref-Hart2005">
<p>Hart, Nathan S., and Misha Vorobyev. 2005. “Modelling Oil Droplet Absorption Spectra and Spectral Sensitivities of Bird Cone Photoreceptors.” <em>Journal of Comparative Physiology A</em> 191 (4): 381–92. <a href="https://doi.org/10.1007/s00359-004-0595-3" class="uri">https://doi.org/10.1007/s00359-004-0595-3</a>.</p>
</div>
<div id="ref-Montgomerie2006">
<p>Montgomerie, Robert. 2006. “Analyzing Colors.” In <em>Bird Coloration, Volume 1: Mechanisms and Measurements</em>, edited by Geoffrey E. Hill and Kevin J. McGraw, 1:640. Bird Coloration. Harvard University Press.</p>
</div>
<div id="ref-Renoult2017">
<p>Renoult, Julien P., Almut Kelber, and H. Martin Schaefer. 2017. “Colour Spaces in Ecology and Evolutionary Biology.” <em>Biological Reviews</em> 92 (1): 292–315. <a href="https://doi.org/10.1111/brv.12230" class="uri">https://doi.org/10.1111/brv.12230</a>.</p>
</div>
<div id="ref-Stoddard2008">
<p>Stoddard, Mary Caswell, and Richard O. Prum. 2008. “Evolution of Avian Plumage Color in a Tetrahedral Color Space: A Phylogenetic Analysis of New World Buntings.” <em>The American Naturalist</em> 171 (6): 755–76. <a href="https://doi.org/10.1086/587526" class="uri">https://doi.org/10.1086/587526</a>.</p>
</div>
<div id="ref-Stoddard2011">
<p>Stoddard, Mary Caswell, and Martin Stevens. 2011. “Avian Vision and the Evolution of Egg Color Mimicry in the Common Cuckoo.” <em>Evolution</em> 65 (7): 2004–13. <a href="https://doi.org/10.1111/j.1558-5646.2011.01262.x" class="uri">https://doi.org/10.1111/j.1558-5646.2011.01262.x</a>.</p>
</div>
<div id="ref-Troje1993">
<p>Troje, Nikolaus. 1993. “Spectral Categories in the Learning Behaviour of Blowflies.” <em>Zeitschrift Für Naturforschung C</em> 48 (1-2): 96–104. <a href="https://doi.org/10.1515/znc-1993-1-218" class="uri">https://doi.org/10.1515/znc-1993-1-218</a>.</p>
</div>
<div id="ref-Vorobyev2001">
<p>Vorobyev, Misha, Robert Brandt, Dagmar Peitsch, Simon B Laughlin, and Randolf Menzel. 2001. “Colour Thresholds and Receptor Noise: Behaviour and Physiology Compared.” <em>Vision Research</em> 41 (5): 639–53. <a href="https://doi.org/10.1016/S0042-6989(00)00288-1" class="uri">https://doi.org/10.1016/S0042-6989(00)00288-1</a>.</p>
</div>
<div id="ref-Vorobyev1998">
<p>Vorobyev, Misha, Daniel Colaco Osorio, Andrew T. D. Bennett, N. Justin Marshall, and Innes C. Cuthill. 1998. “Tetrachromacy, Oil Droplets and Bird Plumage Colours.” <em>Journal of Comparative Physiology A</em> 183 (5): 621–33. <a href="https://doi.org/10.1007/s003590050286" class="uri">https://doi.org/10.1007/s003590050286</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#analysing-spectral-data">Analysing Spectral Data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#spectral-dataset-description">Spectral Dataset Description</a></li>
      <li><a href="#overview">Overview</a></li>
      <li><a href="#spectral-shape-analysis">Spectral Shape Analysis</a></li>
      <li><a href="#visual-modelling">Visual Modelling</a></li>
      </ul>
</li>
      <li>
<a href="#analyzing-spatial-data">Analyzing Spatial Data</a><ul class="nav nav-pills nav-stacked">
<li><a href="#image-based-colour-classification">Image-based colour classification</a></li>
      <li><a href="#adjacency-and-boundary-strength-analyses-and-overall-pattern-contrasts">Adjacency and Boundary Strength Analyses, and Overall Pattern Contrasts</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rafael Maia, Thomas White, Hugo Gruson, John Endler, Chad Eliason, Pierre-Paul Bitton.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9100.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '1988255e7e235678bc3c7f1b86b9ecc5',
    indexName: 'rafaelmaia_pavo',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
